((e,t)=>{"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Aegis=t()})(this,(function(){var e,t,n,r,o,i;function s(t){this.name="__st".concat(1e9*Math.random()>>>0).concat(e,"__"),null!=t&&t.forEach(this.add,this),e+=1}function a(e){if(!(this instanceof a))throw new TypeError("Constructor WeakMap requires 'new'");this.uniqueIdx="".concat("_WeakMap","_").concat(i(),".").concat(i())}Array.prototype.find||Object.defineProperty(Array.prototype,"find",{configurable:!0,writable:!0,value:function(e){if(null===this)throw new TypeError('"this" is null or not defined');var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var r=arguments[1],o=0;o<n;){var i=t[o];if(e.call(r,i,o,t))return i;o+=1}}}),Array.prototype.at||Object.defineProperty(Array.prototype,"at",{configurable:!0,writable:!0,value:function(e){if(null==this)throw new TypeError('"this" is null or not defined');function t(e){return(e=+e)!=e||0==e?0:o(e)}var n,r=Object(this),o=Math.trunc||function(e){return(0<(e=+e)?Math.floor:Math.ceil)(e)},i=0<(n=t(r.length))?Math.min(n,9007199254740991):0;return(e=0<=(e=t(e))?e:i+e)<0||i<=e?void 0:r[e]}}),"undefined"==typeof window||window.WeakSet||(e=Date.now()%1e9,s.prototype.add=function(e){var t=this.name;return e[t]||Object.defineProperty(e,t,{value:!0,writable:!0}),this},s.prototype.delete=function(e){return!!e[this.name]&&!(e[this.name]=void 0)},s.prototype.has=function(e){return!!e[this.name]},t=s,Object.defineProperty(window,"WeakSet",{value:function(e){return new t(e)}})),"undefined"==typeof window||window.WeakMap||(n=Object.defineProperty&&(()=>{try{return 1===Object.defineProperty({},"x",{value:1}).x}catch(e){}})(),r=function(e,t,r){n?Object.defineProperty(e,t,{configurable:!0,writable:!0,value:r}):e[t]=r},o=function(e){return Object(e)===e},i=function(){return Math.random().toString().substring(2)},a.prototype.delete=function(e){var t;return this.checkInstance("delete"),!!o(e)&&!(!(t=e[this.uniqueIdx])||t[0]!==e||(delete e[this.uniqueIdx],0))},a.prototype.has=function(e){var t;return this.checkInstance("has"),!!o(e)&&!(!(t=e[this.uniqueIdx])||t[0]!==e)},a.prototype.get=function(e){var t;return this.checkInstance("get"),o(e)&&(t=e[this.uniqueIdx])&&t[0]===e?t[1]:void 0},a.prototype.set=function(e,t){var n;if(this.checkInstance("set"),o(e))return(n=e[this.uniqueIdx])&&n[0]===e?n[1]=t:r(e,this.uniqueIdx,[e,t]),this;throw new TypeError("Invalid value used as weak map key")},a.prototype.checkInstance=function(e){if(!o(this)||!Object.prototype.hasOwnProperty.call(this,"uniqueIdx"))throw new TypeError("".concat(e," method called on incompatible receiver ").concat(typeof this))},r(window,"WeakMap",a));var c=function(e,t){return(c=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)},u=function(){return(u=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function l(e,t){var n={};for(o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]]);return n}function f(e,t,n,r){return new(n=n||Promise)((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}function d(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){var u=[a,c];if(n)throw new TypeError("Generator is already executing.");for(;i=s&&u[s=0]?0:i;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,(u=o?[2&u[0],o.value]:u)[0]){case 0:case 1:o=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,r=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!((o=0<(o=i.trys).length&&o[o.length-1])||6!==u[0]&&2!==u[0])){i=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3]))i.label=u[1];else if(6===u[0]&&i.label<o[1])i.label=o[1],o=u;else{if(!(o&&i.label<o[2])){o[2]&&i.ops.pop(),i.trys.pop();continue}i.label=o[2],i.ops.push(u)}}u=t.call(e,i)}catch(c){u=[6,c],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}}function p(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||((r=r||Array.prototype.slice.call(t,0,o))[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(null==e)throw new TypeError("Cannot convert first argument to object");for(var t=Object(e),n=1;n<arguments.length;n++)if(null!=(r=arguments[n]))for(var r=Object(r),o=Object.keys(Object(r)),i=0,s=o.length;i<s;i++){var a=o[i],c=Object.getOwnPropertyDescriptor(r,a);null!=c&&c.enumerable&&(t[a]=r[a])}return t}});var h,g=102400,v={snapshootInfo:void 0,type:void 0,level:void 0,plugin:void 0,originEvent:void 0},m="AEGIS_ID",y={PV:"pv",AID:"aid",F_ID:"fId",ERROR:"error",DEVICE:"device",CLOSE:"close",PAGE_PERFORMANCE:"pagePerformance",WEB_VITALS:"webVitals",IE:"ie",SPA:"spa",API:"api",ASSET_SPEED:"assetSpeed",CUSTOM:"custom",SESSION:"session",BRIDGE_SPEED:"bridgeSpeed",LOAD_PACKAGE:"loadPackageSpeed",BLANK_SCREEN:"blankScreen",WEBSOCKET:"websocket",LONGTASK:"longtask",PROCESS_PERFORMANCE:"processPerformance",CRASH:"crash",NETWORK:"network"},w=["aegis.qq.com","tamaegis.com","/aegis-sdk","rumt-","/flog.core.min.js","pingfore.qq.com","pingfore.tencent.com","zhiyan.tencent-cloud.net","h.trace.qq.com","btrace.qq.com","beacon.qq.com","dmplog.qq.com","qq.com/report","svibeacon.onezapp.com","cube.weixinbridge.com","doubleclick.net","pcmgrmonitor.3g.qq.com","tdm.qq.com","report.qqweb.qq.com","tpstelemetry.tencent.com","galileotelemetry.tencent.com","insight.cloud.tencent.com","facebook.com","facebook.net","google","yahoo.com","twitter.com","ga-audiences","report.idqqimg.com","arms-retcode.aliyuncs.com","px.effirst.com","sentry","baidu.com","hot-update.json","u.c.b.r.o.w.s.e.r","report.url.cn","sockjs-node","m3u8","flv"],b=["ResizeObserver loop limit exceeded","ResizeObserver loop completed with undelivered notifications","Failed to execute 'transaction'","window.indexedDB.deleteDatabase is not a function"],E={data:"",event:"",id:"",retry:void 0};(Ue=h=h||{}).data="data",Ue.event="event",Ue.id="id",Ue.retry="retry";var S,T,R,O,C,I=["level","trace","tag","seq","code"],L="SDK-88b1f242f91b60885f0c";function k(e,t){return"string"==typeof t?e===t:e.match(t)}function A(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}Ue=S={INFO:"info",ERROR:"error",SDK_ERROR:"sdk_error",PROMISE_ERROR:"promise_error",AJAX_ERROR:"ajax_error",SCRIPT_ERROR:"script_error",WEBSOCKET_ERROR:"websocket_error",IMAGE_ERROR:"image_error",CSS_ERROR:"css_error",MEDIA_ERROR:"media_error",REPORT:"report",RET_ERROR:"ret_error",BRIDGE_ERROR:"brige_error",BLANK_SCREEN:"blank_screen",CUSTOM_ERROR:"custom_error",PAGE_NOT_FOUND_ERROR:"page_not_found_error",LAZY_LOAD_ERROR:"lazy_load_error",LONGTASK:"longtask"},Ue=T={NORMAL:"normal",PV:"pv",API:"api",CUSTOM_TIME:"custom_time",CUSTOM_EVENT:"custom_event",ASSETS_SPEED:"assets_speed",PAGE_PERFORMANCE:"page_performance",WEB_VITALS:"web_vitals",SDK_ERROR:"sdk_error",SESSION:"session",BRIDGE:"bridge",WEBSOCKET:"websocket",SSE:"sse",PROCESS_PERFORMANCE:"process_performance",CRASH:"crash"},Ue=R={android:"android",ios:"iOS",windows:"windows",macos:"macOS",linux:"linux",devtools:"devtools",other:"other"},Ue=O={unknown:"unknown",wifi:"wifi",wired:"wired",net2g:"2G",net3g:"3G",net4g:"4G",net5g:"5G",net6g:"6G"},Ue=C={PROD:"production",DEV:"development",GRAY:"gray",PRE:"pre",DAILY:"daily",LOCAL:"local",TEST:"test",OTHER:"others"};var P,N=function(e,t){if(Array.isArray(t)&&0!==t.length)for(var n=0,r=t;n<r.length;n++)if(k(e,r[n]))return!0;return!1},x=function(e,t){if(!t)return!0;if(Array.isArray(t)){if(0===t.length)return!1;for(var n=0,r=t;n<r.length;n++)if(k(e,r[n]))return!0}return!1},_=((Ue=P={}).init="init",Ue.sampleChange="sampleChange",Ue.destroy="destroy",Ue.configChange="configChange",Ue.errorOccurred="errorOccurred",M.prototype.indexOf=function(e,t){for(var n=0;n<e.length;n++)if(e[n].callback===t)return n;return-1},M.prototype.on=function(e,t,n){var r;if(void 0===n&&(n=0),this)return(r=this.eventsList[e])||(this.eventsList[e]=[],r=this.eventsList[e]),-1===this.indexOf(r,t)&&r.push({name:e,type:n||0,callback:t}),this},M.prototype.one=function(e,t){this.on(e,t,1)},M.prototype.remove=function(e,t){if(this){var n=this.eventsList[e];if(n){if(t)return n.length&&(t=this.indexOf(n,t),n.splice(t,1)),this;try{delete this.eventsList[e]}catch(e){}}return null}},M.prototype.clear=function(){this.eventsList={}},M);function M(){var e=this;this.emit=function(t,n){if(e){var r;if(null!=(o=e.eventsList[t])&&o.length)for(var o=o.slice(),i=0;i<o.length;i++){r=o[i];try{var s=r.callback.apply(e,[n]);if(1===r.type&&e.remove(t,r.callback),!1===s)break}catch(t){throw t}}return e}},this.eventsList={}}function D(){return([1e7]+1e3+4e3+8e3+1e11).replace(/[018]/g,(function(e){return(e^(16*Math.random()&15)>>e/4).toString(16)}))}var q={generateTraceId:H(16),generateSpanId:H(8)},F=Array(32);function H(e){return function(){for(var t=0;t<2*e;t++)F[t]=Math.floor(16*Math.random())+48,58<=F[t]&&(F[t]+=39);return String.fromCharCode.apply(null,F.slice(0,2*e))}}function j(e){var t;return"object"==typeof e&&(t=(e=(e=>{for(var t=0,n=Object.keys(U);t<n.length;t++){var r=n[t],o=e[r]||"function"==typeof e.get&&e.get(r);if(o)return[r,o]}return["",""]})(e))[0],e=e[1],t)?U[t](e):["",""]}var B,U={sw8:function(e){var t=(e=e.split("-"))[1];return e=e[2],t?[atob(t),atob(e)]:["",""]},traceparent:function(e){return[(e=e.split("-"))[1],e[2]]},b3:function(e){return[(e=e.split("-"))[0],e[1]]},"sentry-trace":function(e){return[(e=e.split("-"))[0],e[1]]}},W=(G.prototype.generate=function(e,t){if(void 0===t&&(t={}),this.url=e,!N(this.url,this.ignoreUrls)&&x(this.url,this.urls)&&this.traceType){switch(this.traceType){case"traceparent":this.traceId=this.createTraceparent();break;case"b3":this.traceId=this.createB3();break;case"sw8":this.traceId=this.createSw8();break;case"sentry-trace":this.traceId=this.createSentryTrace();break;default:return console.warn("this trace key ".concat(this.traceType," is not supported")),void(this.traceId="")}return t[this.traceType]&&(this.traceId=t[this.traceType]),{name:this.traceType,value:this.traceId}}},G.prototype.createTraceparent=function(){var e=q.generateSpanId(),t=q.generateTraceId();return"00-".concat(t,"-").concat(e,"-0").concat(Number(1).toString(16))},G.prototype.createB3=function(){var e=q.generateSpanId(),t=q.generateTraceId();return"".concat(t,"-").concat(e,"-").concat(1)},G.prototype.createSw8=function(){var e=new URL(location.href),t=A(),n=A(),r=(n=String(btoa(n)),t=String(btoa(t)),String(btoa("aegis"))),o=String(btoa("2.5.68")),i=String(btoa(encodeURI(location.pathname)));return e=String(btoa(e.host)),"".concat(1,"-").concat(n,"-").concat(t,"-").concat(1,"-").concat(r,"-").concat(o,"-").concat(i,"-").concat(e)},G.prototype.createSentryTrace=function(){var e=D().substring(16),t=D();return"".concat(t,"-").concat(e).concat("-1")},G);function G(e,t,n){void 0===n&&(n=null),this.traceType=e,this.ignoreUrls=t,this.urls=n}function K(e,t){return"string"==typeof e?e.split("?")[t?1:0]||"":e}function X(e,t){return void 0===t&&(t=2048),null==(e=String(e).split("?")[0])?void 0:e.slice(0,t)}function V(e){return"string"==typeof e&&/^\//.test(e)?"https:"===(null==location?void 0:location.protocol):/^https/.test(e)}function J(e,t,n){var r;return void 0===t&&(t=""),n="function"==typeof n?n(e):"",-1===["api","static"].indexOf(n)&&(r=void 0===t?"":t,t=(void 0===e?"":e).split("?")[0],t=de.test(t),de.lastIndex=0,n=t||fe.some((function(e){return-1!==String(r).indexOf(e)}))?"static":"api"),n}function z(e,t,n){return f(void 0,void 0,void 0,(function(){var r,o,i,s;return d(this,(function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),"function"==typeof(null==t?void 0:t.retCodeHandlerAsync)?[2,new Promise((function(r){t.retCodeHandlerAsync(e,null==n?void 0:n.url,null==n?void 0:n.ctx,(function(e){var t=e.code;r({code:void 0===t?"unknown":t,isErr:e=e.isErr})}))}))]:"function"!=typeof(null==t?void 0:t.retCodeHandler)?[3,2]:[4,t.retCodeHandler(e,null==n?void 0:n.url,null==n?void 0:n.ctx,null==n?void 0:n.payload)];case 1:return i=a.sent()||{},[2,{code:void 0===(o=i.code)?"unknown":o,isErr:i=i.isErr}];case 2:return(e="string"==typeof e?JSON.parse(e):e)&&(s="function"==typeof(null==(i=null==t?void 0:t.ret)?void 0:i.join),r=s?null==(s=null==t?void 0:t.ret)?void 0:s.map((function(e){return e.toLowerCase()})):pe,(s=(s=Object.getOwnPropertyNames(e)).filter((function(e){return-1!==r.indexOf(e.toLowerCase())}))).length)?("未知"!==(o=e[s[0]])&&""!==o||(o="unknown"),[2,{code:"".concat(o),isErr:0!==o&&"0"!==o&&"unknown"!==o}]):[2,he];case 3:return a.sent(),[2,he];case 4:return[2]}}))}))}function Q(e,t,n){try{var r="function"==typeof t?t(e,null==n?void 0:n.url)||"":e;return ve(r).slice(0,g)}catch(e){return""}}function Y(e){if("string"==typeof e)return e;try{return e instanceof Error?(JSON.stringify(e,ge())||"undefined").replace(/"/gim,""):JSON.stringify(e,ge())||"undefined"}catch(e){return"error happen when aegis stringify: \n ".concat(e.message," \n ").concat(e.stack)}}function $(e){if("string"==typeof e)return e;try{return JSON.stringify(e,ge())||"undefined"}catch(e){return"error happen when aegis stringify: \n ".concat(e.message," \n ").concat(e.stack)}}function Z(e,t){return"string"!=typeof e||!e||!!t&&("string"==typeof t?-1<e.indexOf(t):Object.keys(t).some((function(n){return-1<e.indexOf(t[n])})))||we.test(e)||w.some((function(t){return-1<e.indexOf(t)}))}function ee(e,t,n){return f(void 0,void 0,void 0,(function(){return d(this,(function(r){switch(r.label){case 0:return"function"!=typeof e?[3,2]:[4,e.call(t,n,t)];case 1:return[2,r.sent()];case 2:return[2,n||[]]}}))}))}function te(e,t){if("string"==typeof t){var n=(t=t.split(".")).pop();if(n)return"object"==typeof(t=t.reduce((function(e,t){return null==e?void 0:e[t]}),e))?t[n]:t}}function ne(e){var t=e.url,n=e.status;return e=e.code,"url: ".concat(t," \nstatus: ").concat(n," \nretcode: ").concat(e)}function re(e){return[S.ERROR,S.PROMISE_ERROR,S.AJAX_ERROR,S.SCRIPT_ERROR,S.IMAGE_ERROR,S.CSS_ERROR,S.MEDIA_ERROR,S.WEBSOCKET_ERROR,S.BRIDGE_ERROR,S.SDK_ERROR,S.BLANK_SCREEN,S.RET_ERROR,S.PAGE_NOT_FOUND_ERROR,S.LAZY_LOAD_ERROR,S.CUSTOM_ERROR].includes(e.level)}function oe(e){var t,n;return 0===e.length?{isStuck:!1,fluency:0}:(t=e.some((function(e){return 6e4<e})),n=e.reduce((function(e,t){var n=Ee.find((function(e){return t<e.max}));return e+((null==n?void 0:n.score)||0)}),0),{isStuck:t,fluency:parseFloat((n/e.length).toFixed(4))})}function ie(e){var t=u({},E);try{var n=(e||"").indexOf("\n\n");e.slice(0,n).split("\n").forEach((function(e){var n=(e=e.split(/:\s+/,2))[0],r=e[1];switch(n.toLowerCase()){case h.data:t.data=t.data?"".concat(t.data,"\n").concat(r):r;break;case h.event:t.event=r;break;case h.id:t.id=r;break;case h.retry:var o=parseInt(r,10);isNaN(o)||(t.retry=o)}}))}catch(e){console.warn("Fail to parse chunk details with errors occurred",e)}return t}function se(e,t){var n=t.reportUrls;return!(N(e,t=t.ignoreUrls)||!x(e,n))}function ae(e){var t=e.isWhiteList,n=e.requestUrl,r=e.config,o=e.isErrorApi;return e=e.reportWhenError,!Z(n,te(r,"hostUrl"))&&(t||o&&e||(o=null==(t=null==Se?void 0:Se.test)?void 0:t.call(Se,n),t=se(n,{reportUrls:(t=null==(e=null==r?void 0:r.plugin)?void 0:e.api).reportUrls,ignoreUrls:e=t.ignoreUrls}),!o&&t))}function ce(e){var t,n=e.isErrorApi,r=e.reportWhenError;return!!e.isWhiteList||!(!n||!r)||(n=e.requestUrl,r=e.apiConfig,e=e.apiDetail,t=r.apiDetailIgnoreUrls,se(n,{reportUrls:r.apiDetailReportUrls,ignoreUrls:t})&&e)}Ue=B={number:-1,"-1":"number",string:""};var ue,le,fe=["application/xhtml+xml","application/xml","application/pdf","application/pkcs12","application/javascript","application/x-javascript","application/ecmascript","application/vnd.mspowerpoint","application/vnd.apple.mpegurl","application/ogg","text/css","text/javascript","image","audio","video","video/mp2t"],de=/\.(json|js|css|jpg|jpeg|png|svg|apng|webp|gif|bmp|mp4|mp3|ts|mpeg|wav|webm|ogg|flv|m3u8|ttf|woff2|otf|eot|woff|html|htm|shtml|shtm|wasm|atlas|pag|)$/gi,pe=["ret","retcode","code","errcode"],he={code:"unknown",isErr:!1},ge=function(){var e=new WeakSet;return function(t,n){if(n instanceof Error)return"Error.message: ".concat(n.message," \n  Error.stack: ").concat(n.stack);if("object"==typeof n&&null!==n){if(e.has(n))return"[Circular ".concat(t||"root","]");e.add(n)}return n}},ve=function(e,t){void 0===t&&(t=3);var n,r,o,i="";return Array.isArray(e)?(i+="[",n=e.length,e.forEach((function(e,r){i=(i+="object"==typeof e&&1<t?ve(e,t-1):ye(e))+"".concat(r===n-1?"":",")})),i+="]"):e instanceof Object?(i="{",r=Object.keys(e),o=r.length,r.forEach((function(n,s){"object"==typeof e[n]&&1<t?i+='"'.concat(n,'":').concat(ve(e[n],t-1)):i+=me(n,e[n]),i+="".concat(s===o-1||s<o-1&&void 0===e[r[s+1]]?"":",")})),i+="}"):i+=e,i},me=function(e,t){var n=typeof t,r="";return"string"==n||"object"==n?r+='"'.concat(e,'":"').concat(t,'"'):"function"==typeof t?r+='"'.concat(e,'":"function ').concat(t.name,'"'):"symbol"==typeof t?r+='"'.concat(e,'":"symbol"'):"number"!=typeof t&&"boolean"!=n||(r+='"'.concat(e,'": ').concat(t)),r},ye=function(e){var t=typeof e;return""+("undefined"==t||"symbol"==t||"function"==t?"null":"string"==t||"object"==t?'"'.concat(e,'"'):e)},we=/data:(image|text|application|font)\/.*;base64/,be=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(!t.length)return e;var r,o=t.shift();for(r in o)"object"==typeof o[r]&&null!==o[r]&&e.hasOwnProperty(r)&&"object"==typeof e[r]&&null!==e[r]?be(e[r],o[r]):e[r]=o[r];return be.apply(void 0,p([e],t,!1))},Ee=[{max:500,score:1},{max:1e3,score:.5},{max:3e3,score:.25},{max:1e4,score:.125},{max:6e4,score:.0625}],Se=/\.flv(\?|$)/i,Te=(Re.prototype.patch=function(e){try{this.canUse(e)&&this.exist(e)&&(this.triggerInit(e),this.triggerOnNewAegis(e),this.plugins.push(e))}catch(t){this.aegis.logger.error("Failed to patch plugin ".concat(e.name,": ").concat(t))}},Re.prototype.unPatch=function(e){var t=this.plugins.indexOf(e);-1!==t&&(this.plugins.splice(t,1),0===this.plugins.length)&&this.uninstall(e)},Re.prototype.uninstall=function(e){var t;null!=(t=null==(t=e.option)?void 0:t.destroy)&&t.call(e.option,this.aegis,this.getConfig(e))},Re.prototype.walk=function(e){var t=this;this.plugins.forEach((function(n){t.canUse(n)&&e(n,t.getConfig(n))}))},Re.prototype.canUse=function(e){return!e||!(!(e=this.getConfig(e))||"object"!=typeof e)||!!e},Re.prototype.getConfig=function(e){var t;return null!=(t=null==(t=this.config)?void 0:t[e.name])?t:null==(t=this.aegis.config)?void 0:t[e.name]},Re.prototype.exist=function(e){return-1===this.plugins.indexOf(e)},Re.prototype.triggerInit=function(e){var t;this.initializedPlugin[e.name]||(e.option.aegis=this.aegis,e.aegis=this.aegis,this.initializedPlugin[e.name]=!0,null==(t=null==(t=e.option)?void 0:t.init))||t.call(e.option,this.aegis,this.getConfig(e))},Re.prototype.triggerOnNewAegis=function(e){var t;ee(this.aegis.config.onBeforeCollect,this.aegis),null!=(t=null==(t=e.option)?void 0:t.onNewAegis)&&t.call(e.option,this.aegis,this.getConfig(e))},Re);function Re(e,t){this.plugins=[],this.initializedPlugin={},this.aegis=e,this.config=t}function Oe(e){return e.filter((function(t,n){return"static"!==(null==t?void 0:t.requestType)||!e.find((function(e,r){return(null==t?void 0:t.url)===e.url&&200===(null==t?void 0:t.status)&&n<r}))}))}function Ce(e){return new Promise((function(t){return Array.isArray(e)?t(e.map((function(e){return t=u(u({},e),{msg:"string"==typeof e.msg?e.msg:[].concat(e.msg).map(Y).join(" ")}),I.forEach((function(e){t[e]||delete t[e]})),t;var t}))):t([u(u({},e),{msg:"string"==typeof e.msg?e.msg:Y(e.msg)})])}))}function Ie(e){if(Array.isArray(e)&&0!==e.length)return function(t){return new Promise((function(n){var r=function(t,o){return f(void 0,void 0,void 0,(function(){var i;return d(this,(function(s){switch(s.label){case 0:return t<e.length?[4,e[t](o)]:[3,2];case 1:return(i=s.sent()).length?r(t+1,i):null!=n&&n([]),[3,3];case 2:null!=n&&n(o),s.label=3;case 3:return[2]}}))}))};r(0,t)}))};throw new TypeError("createPipeline needs at least one function param")}function Le(e,t){Object.getOwnPropertyNames(e).forEach((function(n){"function"==typeof e[n]&&"constructor"!==n&&(t?t[n]="sendPipeline"===n?function(){return function(){}}:function(){}:e[n]=function(){})}))}function ke(e){return Promise.resolve(e)}Ue=ue={hasNotFetched:0,0:"hasNotFetched",fetching:1,1:"fetching",alreadyFetched:2,2:"alreadyFetched"},Ue=le={normalEnd:"normalEnd",errorEnd:"errorEnd"};var Ae,Pe={name:"sample",create:function(e){function t(t,n,r){e.fetchSampleStatus=ue.alreadyFetched,Math.floor(1e3*Math.random())<1&&c.push({msg:"sampleConfig",level:S.INFO,type:T.NORMAL,sampleConfig:e.sampleMap,endType:t,errorMsg:r,remoteSample:n}),e.send(c.splice(0,c.length))}function n(){return e.fetchSampleStatus=ue.fetching,new Promise((function(n){var r=Date.now();e.request({url:"".concat(te(e.config,"hostUrl.whiteListUrl"),"?uid=").concat(a,"&topic=").concat(e.config.id),payload:JSON.stringify({}),headers:e.config.addXTopicKey?{"X-Topic-Key":e.bean.id}:{},method:"GET"},(function(o){var i,a=(o=o.data||JSON.parse(o)).is_in_white_list,c=void 0===(u=o.sample_map)?{}:u,u=o.server_time,l=o.start_server_time;0!==o.code?(e.sampleMap=s,e.event.emit(P.sampleChange)):(e.isWhiteList=!!a,a&&e.config.whiteList?Object.keys(y).forEach((function(e){s[y[e]]=1})):(i={},Object.keys(c).forEach((function(e){i[e.replace(/(_\w)/g,(function(e){return e[1].toUpperCase()}))]=c[e]/100})),be(s,i)),e.sampleMap=s,e.event.emit(P.sampleChange),a=((o=Date.now())-r-(Number(u)-Number(l)))/2,l=Number(u)+a,e.serverTimeGap=Math.floor(l-o)),t(le.normalEnd,c),n()}),(function(r){e.sampleMap=s,e.event.emit(P.sampleChange),t(le.errorEnd,{},null==r?void 0:r.message),n()}))}))}o=e,i={},Object.keys(y).forEach((function(e){e=y[e];var t=te(o.config,"sample.".concat(e));i[e]=t}));var r,o,i,s=i,a=null==(r=e.config)?void 0:r.uid,c=[];return e.event.on(P.configChange,(function(t){t.uid===a&&ue.alreadyFetched===e.fetchSampleStatus||(a=t.uid,setTimeout(n,t.uid?50:500))})),function(t){return new Promise((function(r){return f(void 0,void 0,void 0,(function(){var o,i,s;return d(this,(function(a){switch(a.label){case 0:return ue.alreadyFetched===e.fetchSampleStatus?(o=e.sampleMap,i=e.config.forceReportErrorLog,s=t.filter((function(t){return!t.plugin||!(!e.isWhiteList&&null!=t&&t.isWhiteListDyeLog||(!i||!re(t))&&(t=t.plugin===y.SPA?y.PV:t.plugin,void 0!==(t=o[t]))&&Math.random()>t)})),[2,r(s)]):(c=c.concat(t),ue.hasNotFetched!==e.fetchSampleStatus?[3,2]:[4,n()]);case 1:return a.sent(),[2,r([])];case 2:return ue.fetching===e.fetchSampleStatus?[2,r([])]:[2]}}))}))}))}}},Ne={name:"throttle",create:function(e,t){var n,r=[],o=e.config;return e.event.on(P.destroy,(function(){r.length=0})),function(i){return new Promise((function(s){if(r=r.concat(i),t&&r.length>=t||e.sendNow&&0<r.length)return r=Oe(r),n&&clearTimeout(n),s(r.splice(0,!e.sendNow&&t||r.length));n&&clearTimeout(n),n=setTimeout((function(){n=null,r=Oe(r),s(r.splice(0,r.length))}),o.delay)}))}}},xe={name:"format",create:function(){return Ce}},_e={name:"lengthLimit",create:function(e){return function(t){return f(void 0,void 0,void 0,(function(){var n;return d(this,(function(r){return n=e.config,t=t.map((function(e){var t,r=n.maxLength||g;try{if(!e.msg||e.msg.length<=r)return e;e.msg=null==(t=e.msg)?void 0:t.substring(0,r)}catch(t){e.msg=null==(r=Y(e.msg))?void 0:r.substring(0,n.maxLength)}return e})),[2,Promise.resolve(t)]}))}))}}},Me={},De={},qe={name:"repeatLimit",create:function(e){return t=e.config,function(e){return new Promise((function(n){var r="number"==typeof t.repeat?t.repeat:60;if(!te(t,"sample.speed")||r<=0)return n(e);var o=(null==t?void 0:t.id)||"0",i=De[o]||{};n(e.filter((function(e){var t,n=!i[e.url]||i[e.url]<r;return n?(i[e.url]=1+~~i[e.url],De[o]=i):Me[o]||Me[t=o]||(Me[t]=setTimeout((function(){De[t]={},Me[t]=null}),6e4)),n})))}))};var t}},Fe={},He={},je={name:"errorLogCollectLimit",create:function(e){var t=e.config,n="number"==typeof(t=void 0===t?{}:t).repeat?t.repeat:60,r="".concat(null!=(t=null==t?void 0:t.id)?t:0,"_error"),o=He[r]||{};return He[r]=o,e.event.on(P.destroy,(function(){delete He[r],Fe[r]&&(clearTimeout(Fe[r]),delete Fe[r])})),function(e){return new Promise((function(t){if(n<=0)return t(e);t(e.filter((function(e){var t,i=e.level,s=e.msg;return!(i&&s&&re(e)&&"string"==typeof s)||(e="".concat(i,"_").concat(null==(i=null==(e=null==s?void 0:s.slice)?void 0:e.call(s,0,200))?void 0:i.replace(/[\r\n]+/g,"")),(s=(i=null!=(s=o[e])?s:0)<n)?o[e]=i+1:Fe[r]||(Fe[t=r]||(Fe[t]=setTimeout((function(){He[t]={},Fe[t]=null}),6e4)),Fe[t]),s)})))}))}}},Be=((Ue=Ae={})[Ue.ERROR=0]="ERROR",Ue[Ue.WARN=1]="WARN",Ue[Ue.INFO=2]="INFO",Ue[Ue.DEBUG=3]="DEBUG",Xe.prototype.debug=function(e){this.log(Ae.DEBUG,e)},Xe.prototype.info=function(e){this.log(Ae.INFO,e)},Xe.prototype.warn=function(e){this.log(Ae.WARN,e)},Xe.prototype.error=function(e){this.log(Ae.ERROR,e)},Xe.prototype.log=function(e,t){this.instance.fetchSampleStatus===ue.alreadyFetched?this.instance.isWhiteList&&this.consoleLog(e,t):this.queue.push({level:e,message:t})},Xe.prototype.consoleLog=function(e,t){(e<=this.logLevel||this.instance.isWhiteList)&&console.log("Aegis-[".concat(Ae[e],"] ").concat(t))},Xe),Ue=(Ke.prototype.init=function(){var e=this,t=this.config.env===C.PROD?Ae.ERROR:Ae.DEBUG;this.logger=new Be(t,this),this.pluginController=new Te(this,this.config.plugin),Ke.installedPlugins.forEach((function(t){e.pluginController.patch(t)})),this.event.emit(P.init)},Ke.prototype.setConfig=function(e){var t;return be(this.config,e),this.tempContext.isInTempContext?(t=u({},this.tempContext.originBean),t=this.getNewBean(e,t),this.tempContext.originBean=t):this.extendBean(this.config),this.event.emit(P.configChange,e),ee(this.config.onConfigChange,this),this.config},Ke.prototype.setTempConfig=function(e,t){return f(this,void 0,void 0,(function(){return d(this,(function(n){switch(n.label){case 0:this.sendNow=!0,this.tempContext.isInTempContext=!0,this.tempContext.originBean=u({},this.bean),this.extendBean(e),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,t()];case 2:case 3:return n.sent(),[3,4];case 4:return this.tempContext.isInTempContext=!1,this.sendNow=!1,this.extendBean(this.tempContext.originBean),this.send(this.tempContext.catchLogs.splice(0,this.tempContext.catchLogs.length)),[2]}}))}))},Ke.use=function(e){-1===Ke.installedPlugins.indexOf(e)&&Ke.installedPlugins.push(e)},Ke.unuse=function(e){-1!==(e=Ke.installedPlugins.indexOf(e))&&Ke.installedPlugins.splice(e,1)},Ke.prototype.sendCustomLogs=function(e){return f(this,arguments,void 0,(function(e,t,n,r){var o,i,s,a,c=this;return void 0===t&&(t=S.INFO),void 0===n&&(n=T.NORMAL),void 0===r&&(r={canCustom:!1,isWhiteListDyeLog:!1}),d(this,(function(l){switch(l.label){case 0:return this.canUseCustomPlugin()?(o=r.canCustom,i=r.isWhiteListDyeLog,[4,ee(this.config.onBeforeCollect,this)]):[2];case 1:return l.sent(),f={logLevel:t,logType:n,canCustom:o},s=e.map((function(e){var t=f.canCustom,n=f.logLevel,r=f.logType,o="object"==typeof e?e:{msg:e},i=o.msg||"",s=void 0;return n===S.CUSTOM_ERROR&&(s=i),o instanceof Error?(i=Y(o),s=o.message):i instanceof Error&&(s=i.message,i=Y(i)),u(u({errorMsg:s},o),{msg:i,level:null!=(s=t?e.level:null)?s:n,type:null!=(o=t?e.type:null)?o:r,plugin:y.CUSTOM})})).map((function(e){var t;return u(u({timestamp:Date.now()},e),{aegisv2_goto:q.generateSpanId(),isWhiteListDyeLog:i||void 0,type:null!=(t=e.type)?t:T.NORMAL,level:null!=(t=e.level)?t:S.INFO,plugin:y.CUSTOM,snapshootInfo:JSON.stringify(c.snapshootInfo)})})),[4,ee(this.config.onCollected,this,s)];case 2:return 0<(s=l.sent()).length?this.tempContext.isInTempContext?[4,this.immediatelySend(s)]:[3,4]:[3,7];case 3:return a=l.sent(),[3,6];case 4:return[4,this.send(s)];case 5:a=l.sent(),l.label=6;case 6:return[2,a];case 7:return[2]}var f}))}))},Ke.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return f(this,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return[4,this.sendCustomLogs(e,S.INFO)];case 1:return t.sent(),[2]}}))}))},Ke.prototype.whiteListInfo=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return f(this,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return[4,this.sendCustomLogs(e,S.INFO,T.NORMAL,{canCustom:!0,isWhiteListDyeLog:!0})];case 1:return t.sent(),[2]}}))}))},Ke.prototype.report=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return f(this,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return[4,this.sendCustomLogs(e,S.REPORT,T.NORMAL,{canCustom:!0,isWhiteListDyeLog:!1})];case 1:return t.sent(),[2]}}))}))},Ke.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return f(this,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return[4,this.sendCustomLogs(e,S.CUSTOM_ERROR)];case 1:return t.sent(),[2]}}))}))},Ke.prototype.clearPluginCache=function(){this.pluginController.plugins.forEach((function(e){var t;null!=(t=null==(t=e.option)?void 0:t.clear)&&t.call(e.option,e)}))},Ke.prototype.clearThrottleCache=function(){this.sendNow=!0,this.send([]),this.sendNow=!1},Ke.prototype.reportEvent=function(e){return f(this,void 0,void 0,(function(){var t;return d(this,(function(n){switch(n.label){case 0:return e?(t="string"==typeof e?{name:e,msg:"report_event",level:S.INFO,plugin:y.CUSTOM}:e).name?("string"!=typeof t.name&&(this.logger.warn("reportEvent params name must be string"),t.name=String(t.name)),[4,this.sendCustomLogs([t],S.INFO,T.CUSTOM_EVENT)]):(this.logger.warn("reportEvent params error"),[2]):[2];case 1:return n.sent(),[2]}}))}))},Ke.prototype.canUseCustomPlugin=function(){var e;return!1!==(null==(e=this.config.plugin)?void 0:e[y.CUSTOM])},Ke.prototype.reportTime=function(e,t){return f(this,void 0,void 0,(function(){return d(this,(function(n){switch(n.label){case 0:return"object"!=typeof e?[3,2]:[4,this.reportT(e)];case 1:return[2,n.sent()];case 2:return"string"!=typeof e?(this.logger.warn("reportTime: first param must be a string"),[2]):"number"!=typeof t?(this.logger.warn("reportTime: second param must be number"),[2]):t<0||6e4<t?(this.logger.warn("reportTime: duration must between 0 and 60000"),[2]):[4,this.submitCustomTime(e,t)];case 3:return n.sent(),[2]}}))}))},Ke.prototype.reportT=function(e){return f(this,void 0,void 0,(function(){var t,n,r;return d(this,(function(o){switch(o.label){case 0:return t=e.name,n=e.duration,r=l(e,["name","duration"]),"string"!=typeof t||"number"!=typeof n?(this.logger.warn("reportTime: params error"),[2]):n<0||6e4<n?(this.logger.warn("reportTime: duration must between 0 and 60000"),[2]):[4,this.submitCustomTime(t,n,r)];case 1:return[2,o.sent()]}}))}))},Ke.prototype.time=function(e,t){"string"==typeof e?this.timeMap[e]?this.logger.warn("Timer ".concat(e," already exists")):this.timeMap[e]={startTime:Date.now(),customParams:t}:this.logger.warn("time: first param must be a string")},Ke.prototype.timeEnd=function(e,t){return f(this,void 0,void 0,(function(){return d(this,(function(n){switch(n.label){case 0:return"string"!=typeof e?(this.logger.warn("timeEnd: first param must be a string"),[2]):this.timeMap[e]?[4,this.submitCustomTime(e,Date.now()-this.timeMap[e].startTime,u(u({},this.timeMap[e].customParams),t))]:[3,2];case 1:return n.sent(),delete this.timeMap[e],[3,3];case 2:this.logger.warn("Timer ".concat(e," does not exist")),n.label=3;case 3:return[2]}}))}))},Ke.prototype.submitCustomTime=function(e,t,n){return f(this,void 0,void 0,(function(){return d(this,(function(r){switch(r.label){case 0:return[4,this.sendCustomLogs([u({name:e,duration:t,msg:"custom_time",plugin:y.CUSTOM},n)],S.INFO,T.CUSTOM_TIME)];case 1:return r.sent(),[2]}}))}))},Ke.prototype.updateSnapshootInfo=function(e){be(this.snapshootInfo,e)},Ke.prototype.extendBean=function(e){e=this.getNewBean(e,this.bean),be(this.bean,e)},Ke.prototype.generateRequestOptionsByLogs=function(e){var t,n=this,r=(e=e.map((function(e){var t=e.snapshootInfo||$(n.snapshootInfo||{}),r={};try{be(r,JSON.parse(t))}catch(e){console.warn(">>> Fail to merge snapshootInfo object",e)}return e.aegisv2_goto||(e.aegisv2_goto=q.generateSpanId()),e.timestamp||(e.timestamp=Date.now()),{message:$(u(u(u({},e),v),{timestamp:e.timestamp+n.serverTimeGap})),fields:$(u(u({},r),{type:null!=(t=e.type)?t:T.NORMAL,level:null!=(r=e.level)?r:S.INFO,plugin:e.plugin}))}})),$({topic:this.bean.id||"",bean:u(u({},this.bean),{id:void 0}),ext:$((null==(r=this.config)?void 0:r.extField)||{}),scheme:"v2",d2:(t={},e.forEach((function(e){var n=e.fields;t[n]||(t[n]={fields:e.fields,message:[]}),t[n].message.push(e.message)})),Object.keys(t).map((function(e){return t[e]}))),v:"2.5.68"}));return e={payload:r,isCompressed:!1},this.config.compress&&(e=this.sendNow?e:this.compressLogs(r)),u(u({},e),{headers:u(u({"Content-Type":"text/plain;charset=UTF-8"},e.isCompressed?{"Content-Encoding":"gzip"}:{}),this.config.addXTopicKey?{"X-Topic-Key":this.bean.id}:{}),url:te(this.config,"hostUrl.url"),method:"POST"})},Ke.prototype.send=function(e,t,n){var r,o,i,s,a=this;if(!this.tempContext.isInTempContext)return this.sendPipeline||(this.sendPipeline=Ie([(i=[],(o=this).event.on(P.destroy,(function(){i.length=0})),s=!0,function(e){return new Promise((function(t){var n;!s||null!=(n=null==o?void 0:o.canProceedLogs)&&n.call(o)?(0<i.length&&(e.push.apply(e,i),i.length=0),s=!1,t(e)):(i=i.concat(e),t([]))}))}),Ne.create(this,this.config.maxBatchReportLength),Pe.create(this),je.create(this),function(e){return f(a,void 0,void 0,(function(){var t,n;return d(this,(function(r){switch(r.label){case 0:return n=(t=Promise).resolve,[4,ee(this.config.onBeforeSend,this,e)];case 1:return[2,n.apply(t,[r.sent()])]}}))}))},function(e){return new Promise((function(r){if(0===e.length)return r([]);a.sendLogs(e,(function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];a.failRequestCount=0,r(p(p([],e,!0),[{isErr:!1,result:n}],!1)),null!=t&&t.apply(void 0,n)}),(function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];60<=++a.failRequestCount&&a.destroy(),r(p(p([],e,!0),[{isErr:!0,result:t}],!1)),null!=n&&n.apply(void 0,t)}))}))},function(e){return f(a,void 0,void 0,(function(){var t,n;return d(this,(function(r){switch(r.label){case 0:return n=(t=Promise).resolve,[4,ee(this.config.onSended,this,e)];case 1:return[2,n.apply(t,[r.sent()])]}}))}))}])),this.sendPipeline(e);(r=this.tempContext.catchLogs).push.apply(r,e)},Ke.prototype.sendLogsImmediately=function(e,t){return f(this,void 0,void 0,(function(){var n,r,o,i=this;return d(this,(function(s){switch(s.label){case 0:return[4,ee(this.config.onBeforeCollect,this)];case 1:return s.sent(),o=void 0===(o=(r=t||{}).addSnapshot)||o,n=r.success,r=r.fail,o=o?e.map((function(e){return e.snapshootInfo||(e.snapshootInfo=$(i.snapshootInfo||{})),e})):e,[4,ee(this.config.onCollected,this,o)];case 2:return o=s.sent(),[2,this.immediatelySend(o,n,r)]}}))}))},Ke.prototype.performRequest=function(e,t,n){throw new Error('You need to override "performRequest" method')},Ke.prototype.compressLogs=function(e){return{payload:e,isCompressed:!1}},Ke.prototype.ready=function(){var e=this;(function t(){var n,r,o,i,s;e.reportRequestQueue.length&&(r=(n=e.reportRequestQueue.shift()).logs,o=n.success,i=n.fail,s=e.generateRequestOptionsByLogs(r),e.request(s,(function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return null==o?void 0:o.apply(s,e)}finally{t()}}),(function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return null==i?void 0:i.apply(s,e)}finally{t()}})))})(),this.isReportReady=!0},Ke.prototype.request=function(e,t,n){var r,o=this;return e&&this.bean.id?e.url?void(r=function(i){void 0===i&&(i=0),o.performRequest(e,t,(function(e){var t=(s=o.config).maxRetryCount,s=s.enableRetry;i<(t=void 0===t?3:t)&&void 0!==s&&s?(o.logger.warn("Request failed, retrying (".concat(i,"/").concat(t,")...")),r(i+1)):null!=n&&n(e)}))})():this.logger.error("request url is empty"):this.logger.error("Invalid parameters or missing project ID, request forbidden")},Ke.prototype.sendSDKError=function(e){return f(this,void 0,void 0,(function(){var t=this;return d(this,(function(n){switch(n.label){case 0:return[4,this.setTempConfig({id:L},(function(){return t.sendCustomLogs([u(u({},e),{errorToken:t.config.id,aegisSDKVersion:"2.5.68",errorConfig:$(t.config)})],S.SDK_ERROR,T.SDK_ERROR)}))];case 1:return n.sent(),[2]}}))}))},Ke.prototype.destroy=function(){return f(this,arguments,void 0,(function(e){var t,n,r;return void 0===e&&(e=!1),d(this,(function(o){switch(o.label){case 0:return[4,ee(this.config.onBeforeDestroy,this)];case 1:o.sent(),-1!==(t=Ke.instances.indexOf(this))&&Ke.instances.splice(t,1),t=Ke.installedPlugins.length-1,o.label=2;case 2:if(!(0<=t))return[3,7];o.label=3;case 3:return o.trys.push([3,4,,6]),n=Ke.installedPlugins[t],this.pluginController.unPatch(n),[3,6];case 4:return n=o.sent(),[4,this.sendSDKError({msg:Y(n)})];case 5:return o.sent(),[3,6];case 6:return t--,[3,2];case 7:if(this.event.emit("destroy"),this.event.clear(),e)i=this,s=Object.getOwnPropertyDescriptors(i),Object.keys(s).forEach((function(e){s[e].writable&&(i[e]=null)})),Object.setPrototypeOf(this,null);else{for(r=this;r.constructor!==Object&&Le(r,this),r=Object.getPrototypeOf(r););0===Ke.instances.length&&(Le(Object.getPrototypeOf(this).constructor),Le(Ke))}return ee(this.config.onDestroyed,this),[2]}var i,s}))}))},Ke.prototype.canProceedLogs=function(){return!0},Ke.prototype.immediatelySend=function(e,t,n){var r=this;return Ie([function(e){return f(r,void 0,void 0,(function(){var t,n;return d(this,(function(r){switch(r.label){case 0:return n=(t=Promise).resolve,[4,ee(this.config.onBeforeSend,this,e)];case 1:return[2,n.apply(t,[r.sent()])]}}))}))},function(e){return new Promise((function(o){if(0===e.length)return o([]);r.sendLogs(e,(function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];r.failRequestCount=0,o(p(p([],e,!0),[{isErr:!1,result:n}],!1)),null!=t&&t.apply(void 0,n)}),(function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];60<=++r.failRequestCount&&r.destroy(),o(p(p([],e,!0),[{isErr:!0,result:t}],!1)),null!=n&&n.apply(void 0,t)}))}))},function(e){return f(r,void 0,void 0,(function(){var t,n;return d(this,(function(r){switch(r.label){case 0:return n=(t=Promise).resolve,[4,ee(this.config.onSended,this,e)];case 1:return[2,n.apply(t,[r.sent()])]}}))}))}])(e)},Ke.prototype.sendLogs=function(e,t,n){this.config.reportImmediately||this.isReportReady?this.request(this.generateRequestOptionsByLogs(e),t,n):this.reportRequestQueue.push({logs:e,success:t,fail:n})},Ke.version="2.5.68",Ke.instances=[],Ke.logLevel=S,Ke.environment=C,Ke.installedPlugins=[],Ke),We=(Ge.prototype.getConfig=function(){var e;return null!=(e=null==(e=this.aegis.config)?void 0:e[this.name])?e:null==(e=this.aegis.config)?void 0:e[this.name]},Ge.prototype.publish=function(e,t){return f(this,void 0,void 0,(function(){var n,r,o,i,s=this;return d(this,(function(a){switch(a.label){case 0:return n=t||this.aegis,r=Date.now(),n.pluginController.canUse(this)?(o=(Array.isArray(e)?e:[e]).map((function(e){var t=s.name===y.API||s.name===y.ASSET_SPEED,o=(null==n?void 0:n.snapshootInfo).action,i=u({},n.snapshootInfo);return t&&o&&(t=r-(null!=(t=null==e?void 0:e.duration)?t:0),(null==o?void 0:o.timestamp)>t)&&delete i.action,o={type:null!=(o=e.type)?o:T.NORMAL,level:null!=(t=e.level)?t:S.INFO,plugin:s.name},u(u(u({aegisv2_goto:q.generateSpanId(),timestamp:r},e),o),{snapshootInfo:JSON.stringify(i)})})),[4,ee(n.config.onCollected,n,o)]):[2,!1];case 1:return 0===(o=a.sent()).length?[2,!1]:(null!=(i=o.filter(re))&&i.length&&n.event.emit(P.errorOccurred,i),null!=(i=this.option.pipes)&&i.length?this.generatePipeline(this.option.pipes,n)(o):n.send(o),[2,!0])}}))}))},Ge.prototype.wrapPipe=function(e,t){var n,r,o,i;return"string"==typeof e?null!=(o=null==(o=t.pipes.find((function(t){return t.name===e})))?void 0:o.create(t))?o:ke:(o=null!=(o=e)?o:{},n=o.name,r=o.option,o=o.create,"string"!=typeof n?e:(i=t.pipes.find((function(e){return e.name===n})),null!=(o=null!=(o=null==o?void 0:o(t,r))?o:null==i?void 0:i.create(t,r))?o:ke))},Ge);function Ge(e){var t,n=this;this.generatePipeline=function(e,t){return(e=e.map((function(e){return n.wrapPipe(e,t)}))).unshift((function(e){return f(n,void 0,void 0,(function(){var n,r;return d(this,(function(o){switch(o.label){case 0:return r=(n=Promise).resolve,[4,ee(t.config.onBeforeProcess,t,e)];case 1:return[2,r.apply(n,[o.sent()])]}}))}))})),e.push((function(e){return f(n,void 0,void 0,(function(){var n,r;return d(this,(function(o){switch(o.label){case 0:return r=(n=Promise).resolve,[4,ee(t.config.onProcessed,t,e)];case 1:return[2,r.apply(n,[o.sent()])]}}))}))})),e.push((function(e){return new Promise((function(n){t.send(e),n(e)}))})),Ie(e)},this.option=e,this.name=e.name,this.init=null==(t=e.init)?void 0:t.bind(this),this.onNewAegis=null==(t=e.onNewAegis)?void 0:t.bind(this),this.destroy=null==(t=e.destroy)?void 0:t.bind(this),this.option.$getConfig=this.getConfig.bind(this),this.option.publish=this.publish.bind(this)}function Ke(e){var t;this.pipes=[Pe,Ne,xe,_e,qe,je],this.fetchSampleStatus=ue.hasNotFetched,this.config={id:"",uid:"",delay:1e3,repeat:60,sample:1,env:"production",maxLength:102400,maxBatchReportLength:400,whiteList:!0,hostUrl:{url:"https://galileotelemetry.tencent.com/collect",whiteListUrl:"https://galileotelemetry.tencent.com/aegiscontrol/whitelist"},plugin:{pv:!0,aid:!0,error:!0,device:!0,close:!0,pagePerformance:!0,webVitals:!0,custom:!0,fId:!1,ie:!1,spa:!1,api:!1,assetSpeed:!1,session:!1,websocket:!1,blankScreen:!1},reportImmediately:!0,forceReportErrorLog:!1,compress:!1,sendPvImmediately:!0,maxRetryCount:3,enableRetry:!1,addXTopicKey:!1},this.event=new _,this.bean={},this.snapshootInfo={},this.serverTimeGap=0,this.sampleMap={},this.isWhiteList=!1,this.tempContext={isInTempContext:!1,catchLogs:[],originBean:{}},this.isReportReady=!1,this.reportRequestQueue=[],this.timeMap={},this.failRequestCount=0,this.getNewBean=function(e,t){var n;return{id:null!=(n=e.id)?n:t.id,uid:null!=(n=e.uid)?n:t.uid,version:null!=(n=e.version)?n:t.version,aid:null!=(n=e.aid)?n:t.aid,env:null!=(n=e.env)?n:t.env,platform:null!=(n=e.platform)?n:t.platform,netType:null!=(n=e.netType)?n:t.netType,vp:null!=(n=e.vp)?n:t.vp,sr:null!=(n=e.sr)?n:t.sr,sessionId:null!=(n=e.sessionId)?n:t.sessionId,from:null!=(n=e.from)?n:t.from,referer:null!=(n=e.referer)?n:t.referer}},e.hostUrl=void 0===(t=e.hostUrl)?{}:"string"==typeof t?{url:t}:t,e.uid="".concat(e.uid),this.setConfig(e),Ke.instances.push(this),ee(this.config.onNewAegis,this)}function Xe(e,t){void 0===e&&(e=Ae.INFO);var n=this;this.queue=[],this.logLevel=e,this.instance=t,this.instance.event.on(P.sampleChange,(function(){n.instance.isWhiteList&&n.queue.forEach((function(e){var t=e.level;return e=e.message,n.consoleLog(t,e)})),n.queue.length=0}))}function Ve(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)e[n]=r[n]}return e}function Je(e,t){function n(r){"pagehide"!==r.type&&"hidden"!==document.visibilityState||(e(r),t&&(removeEventListener("visibilitychange",n,!0),removeEventListener("pagehide",n,!0)))}addEventListener("visibilitychange",n,!0),addEventListener("pagehide",n,!0)}function ze(e){var t=(e=e||{}).name,n=e.initiatorType;if(ct.test(t))return"js";if(ut.test(t))return"css";switch(n){case"script":return"js";case"link":return"css";default:return n}}function Qe(e){var t=e.domainLookupStart,n=e.domainLookupEnd,r=e.fetchStart,o=e.connectEnd,i=e.connectStart,s=e.secureConnectionStart,a=e.responseStart,c=e.responseEnd;return e=e.duration,{preHandleTime:0!==t?Number((t-r).toFixed(2)):0,duration:Number(e.toFixed(2)),domainLookup:Number((n-t).toFixed(2)),connectTime:Number((o-i).toFixed(2)),tlsTime:Number((o-s).toFixed(2)),tcpAndRequestGap:0,requestTime:Number((a-o).toFixed(2)),responseTime:Number((a?c-a:e).toFixed(2))}}function Ye(e){window.WebSocket=pt;var t=ht.findIndex((function(t){return t.key===e.key}));-1!==t&&ht.splice(t,1)}function $e(e){var t,n,r;window.Proxy&&window.WebSocket&&(t=window.WebSocket,window&&!t.isHack&&(n=new Proxy(WebSocket,vt),t.isHack=!0,window.WebSocket=n),r=e,ht.find((function(e){return e.key===r.key}))||r&&ht.push(r))}function Ze(e,t,n,r){return void 0===n&&(n=yt),void 0===r&&(r=0),(t=void 0===t?0:t)<=e&&e<=n?e:r}function et(e,t,n,r){var o,i;return function(s){0<=t.value&&(s||r)&&((i=t.value-(null!=o?o:0))||void 0===o)&&(o=t.value,t.delta=i,t.rating=(s=t.value)>n[1]?"poor":s>n[0]?"needs-improvement":"good",e(t))}}function tt(e){requestAnimationFrame((function(){return requestAnimationFrame((function(){return e()}))}))}function nt(e,t){void 0===t&&(t=-1);var n=Tt(),r="navigate";return 0<=Et?r="back-forward-cache":n&&(document.prerendering||0<Rt()?r="prerender":document.wasDiscarded?r="restore":n.type&&(r=n.type.replace(/_/g,"-"))),{name:e,value:t,rating:"good",delta:0,entries:[],id:"v5-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:r}}function rt(){return void 0!==window.performance&&"function"==typeof performance.getEntriesByType&&"function"==typeof performance.now}var ot,it,st=function e(t,n){function r(e,r,o){if("undefined"!=typeof document){"number"==typeof(o=Ve({},n,o)).expires&&(o.expires=new Date(Date.now()+864e5*o.expires)),o.expires&&(o.expires=o.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var i,s="";for(i in o)o[i]&&(s+="; "+i,!0!==o[i])&&(s+="="+o[i].split(";")[0]);return document.cookie=e+"="+t.write(r,e)+s}}return Object.create({set:r,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var n=document.cookie?document.cookie.split("; "):[],r={},o=0;o<n.length;o++){var i=n[o].split("="),s=i.slice(1).join("=");try{var a=decodeURIComponent(i[0]);if(r[a]=t.read(s,a),e===a)break}catch(e){}}return e?r[e]:r}},remove:function(e,t){r(e,"",Ve({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,Ve({},this.attributes,t))},withConverter:function(t){return e(Ve({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(n)},converter:{value:Object.freeze(t)}})}({read:function(e){return(e='"'===e[0]?e.slice(1,-1):e).replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"}),at=new We({name:y.AID,aid:"",init:function(e){return f(this,void 0,void 0,(function(){var t;return d(this,(function(n){switch(n.label){case 0:return n.trys.push([0,1,,3]),(t="string"==typeof(t=null==(t=e.config.plugin)?void 0:t.aid)?t:window.localStorage?window.localStorage.getItem(m):st.get(m))||(r=t=A(),window.localStorage?window.localStorage.setItem(m,r):st.set(m,r)),this.aid=t,[3,3];case 1:return t=n.sent(),[4,e.sendSDKError({msg:Y(t)})];case 2:return n.sent(),[3,3];case 3:return[2]}var r}))}))},onNewAegis:function(e){e.bean.aid=this.aid,e.config.aid=this.aid}}),ct=/\.js(\?|$)/i,ut=/\.css(\?|$)/i,lt=(new We({name:y.ASSET_SPEED}),new We({name:y.ASSET_SPEED,pipes:["repeatLimit","networkRefresh"],collectCur:0,collectEntryType:"resource",ASSETS_INITIATOR_TYPE:["img","css","script","link","audio","video"],observer:null,onNewAegis:function(e){var t=this;rt()&&(this.collectSuccessLog(e),this.collectFailLog(e),performance.onresourcetimingbufferfull=function(){"function"==typeof performance.clearResourceTimings&&(t.collectCur=0,performance.clearResourceTimings())})},publishMany:function(e,t){for(var n=t.config,r=0,o=e.length;r<o;r++){var i=e[r];-1===this.ASSETS_INITIATOR_TYPE.indexOf(i.initiatorType)||Z(i.name,te(n,"hostUrl"))||this.publish(this.generateLog(i,n),t)}},collectSuccessLog:function(e){var t,n=this;"function"==typeof(null==window?void 0:window.PerformanceObserver)?(this.publishMany(performance.getEntriesByType(this.collectEntryType),e),this.observer=new window.PerformanceObserver((function(t){n.publishMany(t.getEntries(),e)})),this.observer.observe({entryTypes:[this.collectEntryType]}),e.event.on(P.destroy,(function(){var e;null!=(e=n.observer)&&e.disconnect()}))):(t=setInterval((function(){var t=performance.getEntriesByType(n.collectEntryType),r=t.slice(n.collectCur);n.collectCur=t.length,n.publishMany(r,e)}),3e3),e.event.on(P.destroy,(function(){clearInterval(t)})))},collectFailLog:function(e){function t(t){var o,i,s;t&&(t=t.target||t.srcElement,!(o=(null==t?void 0:t.src)||(null==t?void 0:t.href))||"string"!=typeof o||-1<window.location.href.indexOf(o)||(t=performance.getEntriesByType(n.collectEntryType).find((function(e){return e.name===o})),i="function"==typeof(i=(null==(i=r.plugin)?void 0:i.api).resourceTypeHandler)?i(o):ze(t),Z(o,te(r,"hostUrl")))||(s="function"==typeof(s=(null==(s=r.plugin)?void 0:s.assetSpeed).urlHandler)?s(o):o,s={msg:"static_fail",errorMsg:"load ".concat(X(o)," fail"),url:X(s),status:400,duration:Number(((null==t?void 0:t.duration)||0).toFixed(2)),method:"get",assetType:i||"static",isHttps:V(o),urlQuery:K(o,!0),nextHopProtocol:"",domainLookup:B.number,connectTime:B.number,tlsTime:B.number,requestTime:B.number,responseTime:B.number,preHandleTime:B.number,tcpAndRequestGap:B.number,level:S.ERROR,type:T.ASSETS_SPEED},n.publish(s,e)))}var n=this,r=e.config;window.document.addEventListener("error",t,!0),e.event.on(P.destroy,(function(){window.document.removeEventListener("error",t,!0)}))},generateLog:function(e,t){var n=(null==(n=t.plugin)?void 0:n.api).resourceTypeHandler;return t="function"==typeof(t=(null==(t=t.plugin)?void 0:t.assetSpeed).urlHandler)?t(e.name):e.name,n="function"==typeof n?n(e.name):ze(e),u({msg:"asset_speed",url:X(t),status:200,assetType:n||"static",isHttps:V(e.name),nextHopProtocol:e.nextHopProtocol||"",urlQuery:K(e.name,!0),transferSize:0<e.transferSize?e.transferSize:-1,method:"get",type:T.ASSETS_SPEED},Qe(e))},collectNotReportedLog:function(e){var t,n;rt()&&(t=(n=performance.getEntriesByType(this.collectEntryType)).length,"function"!=typeof window.PerformanceObserver)&&this.collectCur!==t&&(n=n.slice(this.collectCur),this.collectCur=t,this.publishMany(n,e))},destroy:function(){var e;this.publish=function(){},null!=(e=this.observer)&&e.disconnect()}})),ft=((ft=ot={}).unknown="unknown",ft.normal="normal",ft.weak="weak",ft.disconnected="disconnected",new We({name:y.DEVICE,onNewAegis:function(e){e.extendBean({platform:this.getPlatform(),netType:O.unknown}),this.getDpi(e),this.getWechatVersion(e),this.refreshNetworkTypeToBean(e),this.refreshNetworkStatusToBean(e)},getDpi:function(e){e.extendBean({vp:"".concat(Math.round(window.innerWidth)," * ").concat(Math.round(window.innerHeight))}),window.screen&&e.extendBean({sr:"".concat(Math.round(window.screen.width)," * ").concat(Math.round(window.screen.height))})},getPlatform:function(){var e={android:/\bAndroid\s*([^;]+)/,ios:/\b(iPad|iPhone|iPod)\b.*? OS ([\d_]+)/,windows:/\b(Windows NT|Windows)/,macos:/\b(Mac OS|OSX)/,linux:/\b(Linux)/i},t=Object.keys(e).find((function(t){return e[t].test(navigator.userAgent)}));return t?R[t]:R.other},getWechatVersion:function(e){var t=navigator.userAgent;t=/Micromessenger/i.test(t)?(null==(t=t.match(/MicroMessenger\/([\d.]+)/i))?void 0:t[1])||"":void 0,e.setConfig({extField:{wechatVersion:t}})},refreshNetworkTypeToBean:function(e){var t=this,n=e.config;n&&("function"==typeof n.getNetworkType?n.getNetworkType:dt)((function(n){Object.keys(O).some((function(e){return O[e]===n}))||(n=O.unknown),e.extendBean({netType:n}),t.NetworkRefreshTimer=setTimeout((function(){t.refreshNetworkTypeToBean(e),clearTimeout(t.NetworkRefreshTimer)}),1e4)}))},refreshNetworkStatusToBean:function(e){var t,n=this,r=e.config;r&&null!=(t="function"==typeof r.getNetworkStatus?r.getNetworkStatus:t)&&t((function(t){Object.keys(ot).some((function(e){return ot[e]===t}))||(t=ot.unknown),e.extendBean({netStatus:t}),n.NetworkStatusRefreshTimer=setTimeout((function(){n.refreshNetworkStatusToBean(e),clearTimeout(n.NetworkStatusRefreshTimer)}),1e4)}))}})),dt=function(e){var t="",n=navigator.userAgent.match(/NetType\/(\w+)/);n?t=n[1]:navigator.connection&&(t=navigator.connection.effectiveType||navigator.connection.type),e((n=t=t||"unknown",0<=(n=String(n).toLowerCase()).indexOf("4g")?O.net4g:0<=n.indexOf("wifi")?O.wifi:0<=n.indexOf("5g")?O.net5g:0<=n.indexOf("6g")?O.net6g:0<=n.indexOf("3g")?O.net3g:0<=n.indexOf("2g")?O.net2g:O.unknown))},pt="undefined"!=typeof window?window.WebSocket:void 0,ht=[],gt={},vt={construct:function(e,t){var n=t[0],r=new e(n,t[1]),o=(r.originSend=r.send,Date.now()),i=!1;return r.addEventListener("open",(function(){var e,t=Date.now();gt[n]=null!=(e=gt[n])?e:{},ht.forEach((function(e){var r,i=e.sendConnectInfo;e=e.key,gt[n][e]=null!=(r=gt[n][e])&&r,null!=i&&i({msg:"WebSocket connection succeeded",url:n,successFlag:!0,duration:t-o,retryFlag:gt[n][e]}),gt[n][e]=!1})),i=!0})),r.addEventListener("error",(function(e){var t=((null==e?void 0:e.currentTarget)||{}).readyState;null!=ht&&ht.forEach((function(e){null!=(e=e.onErr)&&e({msg:"Unable to retrieve specific error information, please check the browser console!",readyState:t,connectUrl:n})}))})),r.addEventListener("close",(function(e){var t;gt[n]=null!=(t=gt[n])?t:{},i||1e3===e.code?(i=!1,ht.forEach((function(e){e=e.key,gt[n][e]=!1}))):(ht.forEach((function(t){var r,o=t.sendConnectInfo;t=t.key,gt[n][t]=null!=(r=gt[n][t])&&r,null!=o&&o(u(u({},e),{msg:"WebSocket connection failed",url:n,successFlag:!1,retryFlag:gt[n][t]})),gt[n][t]=!0})),i=!1)})),Object.defineProperty(r,"send",{get:function(){return function(e){null!=(t=r.originSend)&&t.call(r,e);var t=r.readyState;if(t!==(e=WebSocket.OPEN)){var n={readyState:t,connectUrl:r.url};switch(t){case WebSocket.CLOSED:ht.forEach((function(e){null!=(e=e.sendErr)&&e(u({msg:"Message sending failed, the connection is closed!"},n))}));break;case WebSocket.CONNECTING:ht.forEach((function(e){(0,e.sendErr)(u({msg:"Message sending failed, connecting..."},n))}));break;case WebSocket.CLOSING:ht.forEach((function(e){(0,e.sendErr)(u({msg:"Message sending failed, connection is closing!"},n))}))}}}}}),r}},mt=(new We({name:y.ERROR}),new We({name:y.ERROR,onNewAegis:function(e){this.startListen(e)},startListen:function(e){function t(t){var n,r=t&&Y(t.reason);r&&o.publishErrorLog({msg:"PROMISE_ERROR: ".concat(r),errorMsg:null==(r=null==(n=(null==(n=t.reason)?void 0:n.message)||(null==(n=t.reason)?void 0:n.errMsg)||r)?void 0:n.slice)?void 0:r.call(n,0,150),level:S.PROMISE_ERROR,type:T.NORMAL,originEvent:t},e)}function n(t){var n;if(i=(null==t?void 0:t.target)||(null==t?void 0:t.srcElement)){var r=i.src||i.href||"",i=void 0===(i=i.tagName)?"script":i;if(!(Z(n=r,te(e.config,"hostUrl"))||-1<window.location.href.indexOf(n))){var s={msg:"".concat(i," load fail: ").concat(r),level:S.INFO,type:T.NORMAL,originEvent:t};if(/\.js$/.test(r))s.level=S.SCRIPT_ERROR;else if(/\.css$/.test(r))s.level=S.CSS_ERROR;else switch(i.toLowerCase()){case"script":s.level=S.SCRIPT_ERROR;break;case"link":s.level=S.CSS_ERROR;break;case"img":s.level=S.IMAGE_ERROR;break;case"audio":case"video":s.level=S.MEDIA_ERROR;break;default:return}o.publishErrorLog(s,e)}}}var r,o=this,i=window.onerror;window.onerror=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r,s=Y(t[0]);"string"!=typeof(r=s)||!r||b.some((function(e){return-1<r.indexOf(e)}))||w.some((function(e){return-1<r.indexOf(e)}))||o.publishErrorLog({msg:"".concat(s||""," @ (").concat(Y(t[1])||"",":").concat(t[2]||0,":").concat(t[3]||0,")\n          \n").concat(Y(t[4]||"")),errorMsg:s,level:S.ERROR,type:T.NORMAL,originEvent:t[4]},e),null!=i&&i.call.apply(i,p([window],t,!1))},window.addEventListener("unhandledrejection",t),window.document.addEventListener("error",n,!0),e.event.on(P.destroy,(function(){window.document.removeEventListener("unhandledrejection",t),window.document.removeEventListener("error",n,!0)})),e.config.websocketHack&&(r={key:"".concat(e.config.id,"-").concat(this.name),onErr:function(t){var n;null!=(n=o.publishWsErrorLog)&&n.call(o,t,e)},sendErr:function(t){var n;null!=(n=o.publishWsErrorLog)&&n.call(o,t,e)}},this.hackWebsocketConfig=r,$e(this.hackWebsocketConfig))},publishErrorLog:function(e,t){var n=e.type,r=e.level;e=l(e,["type","level"]),this.publish(u({level:r||S.ERROR,type:n||T.NORMAL},e),t)},publishWsErrorLog:function(e,t){var n=e.connectUrl,r=e.msg;e=e.readyState,this.publishErrorLog({msg:"WEBSOCKET_ERROR: \n              connect: ".concat(n,"\n              readyState: ").concat(e,"\n              msg: ").concat(r),level:S.WEBSOCKET_ERROR,type:T.NORMAL},t)},destroy:function(){this.publishErrorLog=function(){},this.hackWebsocketConfig&&Ye(this.hackWebsocketConfig)}})),yt=(new We({name:y.PAGE_PERFORMANCE}),15e3),wt=3,bt=new We({name:y.PAGE_PERFORMANCE,performanceMap:{},longTaskObserver:null,onNewAegis:function(e){rt()&&(it?this.publish(it,e):this.startCalcPerformance(e),this.getPerfConf(e).longtask)&&this.startLongtaskObserver(e)},getPerfConf:function(e){return{longtask:"object"==typeof(e=((null==(e=e.config)?void 0:e.plugin)||{}).pagePerformance)&&null!==e&&"longtask"in e&&!!e.longtask}},startLongtaskObserver:function(e){var t=this;window.PerformanceObserver&&(this.longTaskObserver=new PerformanceObserver((function(n){n.getEntries().forEach((function(n){var r=n.duration,o=n.name;n=n.startTime,n=Math.floor(null!=performance&&performance.timeOrigin?performance.timeOrigin+n:Date.now()-r),t.publish({duration:r,msg:"longtask",name:o,timestamp:n,type:T.PAGE_PERFORMANCE,level:S.LONGTASK},e)}))})),this.longTaskObserver.observe({entryTypes:["longtask"]}))},startCalcPerformance:function(e){var t=this;try{this.getFirstScreenTiming(e,(function(n){var r=performance.timing;r&&(it={msg:"page_performance",type:T.PAGE_PERFORMANCE,dnsLookup:Ze(r.domainLookupEnd-r.domainLookupStart),tcp:Ze(r.connectEnd-r.connectStart),ssl:Ze(0===r.secureConnectionStart?0:r.requestStart-r.secureConnectionStart),ttfb:Ze(r.responseStart-r.requestStart),contentDownload:Ze(r.responseEnd-r.responseStart),domParse:Ze(r.domInteractive-r.domLoading,0,yt,1070),resourceDownload:Ze(r.loadEventStart-r.domInteractive,0,yt,1070),firstScreenTiming:Ze(Math.floor(n),0,yt,yt)},(r=e.config).extraPerformanceData&&"{}"!==JSON.stringify(r.extraPerformanceData)&&(r=(n=r.extraPerformanceData).engineInit,n=n.bundleLoad,it=u(u({},it),{engineInit:Ze(r,0,1e4),bundleLoad:Ze(n,0,1e4)})),t.publish(it,e))}))}catch(e){}},getFirstScreenTiming:function(e,t){var n=this;e.event.on(P.destroy,(function(){f&&clearTimeout(f)}));var r,o,i=this,s=["script","style","link","br"],a=[],c={},u=(-1<(null==(o=null==(o=window.PerformanceObserver)?void 0:o.supportedEntryTypes)?void 0:o.indexOf("paint"))&&(r=new PerformanceObserver((function(o){o.getEntries().forEach((function(o){var i;"paint"===o.entryType&&"first-contentful-paint"===o.name&&0<(i=document.querySelectorAll("[AEGIS-FIRST-SCREEN-TIMING]")).length&&e.config.id&&!n.performanceMap[e.config.id]&&(n.setFirstScreenInfo(e,o.startTime,i[0],i),null!=t&&t(o.startTime),u.disconnect(),r.disconnect(),f)&&clearTimeout(f)}))}))).observe({entryTypes:["paint"]}),new MutationObserver((function(e){var t={roots:[],ignores:[],rootsDomNum:[],time:performance.now()};e.forEach((function(e){null!=e&&e.addedNodes&&Array.prototype.slice.call(e.addedNodes).forEach((function(e){var n;i.isEleInArray(e,t.ignores)?t.ignores.push(e):1===e.nodeType&&e.hasAttribute("AEGIS-FIRST-SCREEN-TIMING")?(Object.prototype.hasOwnProperty.apply(c,[t.time])||(c[t.time]=[]),c[t.time].push(e)):1===e.nodeType&&(i.hasAncestorOrSelfWithAttribute(e,"AEGIS-IGNORE-FIRST-SCREEN-TIMING")?t.ignores.push(e):-1!==s.indexOf(null==(n=null==e?void 0:e.nodeName)?void 0:n.toLocaleLowerCase())||i.isEleInArray(e,t.roots)||(t.roots.push(e),t.rootsDomNum.push(i.walkAndCount(e)||0)))}))})),t.roots.length&&a.push(t)}))),l=(u.observe(document,{childList:!0,subtree:!0}),function(o){(o=void 0===o?0:o)||(s=0,(d=Object.keys(c)).length?(o=Math.max.apply(null,d),n.setFirstScreenInfo(e,o,null==(d=c[o])?void 0:d[0],c)):a.forEach((function(t){for(var r=0;r<t.roots.length;r++)t.rootsDomNum[r]>s&&i.isInFirstScreen(t.roots[r])&&(s=t.rootsDomNum[r],o=t.time,n.setFirstScreenInfo(e,o,t.roots[r]))})),a.length=0,Object.keys(c).forEach((function(e){c[e]=c[e].map((function(e){var t={tagName:e.tagName},n=e.attributes;if(!n)return e;for(var r=0;r<n.length;r++){var o=n[r];o.name&&(t[o.name]=e.getAttribute(o.name))}return t}))})));var s,d=performance.timing,p=d.domInteractive-d.domLoading,h=o;f=null;for(var g=0,v=[p,d=d.loadEventStart-d.domInteractive,h];g<v.length;g++)if(v[g]<=0&&0<wt){f=setTimeout((function(){return l(h)}),3e3);break}f?--wt:(u.disconnect(),null!=r&&r.disconnect(),null!=t&&t(o))}),f=setTimeout((function(){return l()}),3e3)},setFirstScreenInfo:function(e,t,n,r){var o;e.config.id&&this.performanceMap[e.config.id]||(e.config.id&&(this.performanceMap[e.config.id]=!0),("object"!=typeof(null==(o=e.config)?void 0:o.pagePerformance)||null!=(o=e.config.pagePerformance)&&o.firstScreenInfo)&&(e.firstScreenInfo={element:n,timing:t,markDoms:r}))},isEleInArray:function(e,t){return!(!e||e===document.documentElement)&&(-1!==t.indexOf(e)||this.isEleInArray(e.parentElement,t))},isInFirstScreen:function(e){var t,n;return!(!e||"function"!=typeof e.getBoundingClientRect)&&(e=e.getBoundingClientRect(),t=window.innerHeight,n=window.innerWidth,0<=e.left)&&e.left<n&&0<=e.top&&e.top<t&&0<e.width&&0<e.height},walkAndCount:function(e){var t=0;if(e&&1===e.nodeType){t+=1;var n=e.children;if(null!=n&&n.length)for(var r=0;r<n.length;r++)1===n[r].nodeType&&n[r].hasAttribute("AEGIS-IGNORE-FIRST-SCREEN-TIMING")||(t+=this.walkAndCount(n[r]))}return t},hasAncestorOrSelfWithAttribute:function(e,t){for(var n=e;n&&n!==document.body;){if(n.hasAttribute(t))return!0;n=n.parentElement}return!1},destroy:function(){var e,t;this.longTaskObserver&&(null!=(t=(e=this.longTaskObserver).disconnect)&&t.call(e),this.longTaskObserver=null),this.performanceMap={}}}),Et=-1,St=function(e){addEventListener("pageshow",(function(t){t.persisted&&(Et=t.timeStamp,e(t))}),!0)},Tt=function(){var e=performance.getEntriesByType("navigation")[0];if(e&&0<e.responseStart&&e.responseStart<performance.now())return e},Rt=function(){var e=Tt();return null!=(e=null==e?void 0:e.activationStart)?e:0},Ot=new WeakMap;function Ct(e,t){return Ot.get(e)||Ot.set(e,new t),Ot.get(e)}function It(e,t,n){void 0===n&&(n={});try{var r;if(PerformanceObserver.supportedEntryTypes.includes(e))return(r=new PerformanceObserver((function(e){Promise.resolve().then((function(){t(e.getEntries())}))}))).observe(u({type:e,buffered:!0},n)),r}catch(e){}}function Lt(e){var t=!1;return function(){t||(e(),t=!0)}}function kt(){var e,t;return Ft<0&&(e=Rt(),t=document.prerendering||null==(t=globalThis.performance.getEntriesByType("visibility-state").filter((function(t){return"hidden"===t.name&&t.startTime>e}))[0])?void 0:t.startTime,Ft=null!=t?t:Ht(),Bt(),St((function(){setTimeout((function(){Ft=Ht(),Bt()}))}))),{get firstHiddenTime(){return Ft}}}function At(e){document.prerendering?addEventListener("prerenderingchange",(function(){return e()}),!0):e()}function Pt(e,t){void 0===t&&(t={}),At((function(){var n,r=kt(),o=nt("FCP"),i=It("paint",(function(e){for(var t=0,s=e;t<s.length;t++){var a=s[t];"first-contentful-paint"===a.name&&(i.disconnect(),a.startTime<r.firstHiddenTime)&&(o.value=Math.max(a.startTime-Rt(),0),o.entries.push(a),n(!0))}}));i&&(n=et(e,o,Ut,t.reportAllChanges),St((function(r){o=nt("FCP"),n=et(e,o,Ut,t.reportAllChanges),tt((function(){o.value=performance.now()-r.timeStamp,n(!0)}))})))}))}function Nt(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];r.interactionId&&(Kt=Math.min(Kt,r.interactionId),Xt=Math.max(Xt,r.interactionId),Gt=Xt?(Xt-Kt)/7+1:0)}}function xt(){var e;return Dt?Gt:null!=(e=performance.interactionCount)?e:0}function _t(e){var t=globalThis.requestIdleCallback||setTimeout;"hidden"===document.visibilityState?e():(e=Lt(e),document.addEventListener("visibilitychange",e,{once:!0}),t((function(){e(),document.removeEventListener("visibilitychange",e)})))}function Mt(e){var t=e.name;0<(e=e.value)&&e<Number.MAX_SAFE_INTEGER&&($t[t]=e)}tn.prototype.h=function(e){var t,n;e.hadRecentInput||(t=this.o[0],n=this.o.at(-1),this.i&&t&&n&&e.startTime-n.startTime<1e3&&e.startTime-t.startTime<5e3?(this.i+=e.value,this.o.push(e)):(this.i=e.value,this.o=[e]),null!=(n=this.t)&&n.call(this,e))};var Dt,qt=tn,Ft=-1,Ht=function(){return"hidden"!==document.visibilityState||document.prerendering?1/0:0},jt=function(e){"hidden"===document.visibilityState&&-1<Ft&&(Ft="visibilitychange"===e.type?e.timeStamp:0,removeEventListener("visibilitychange",jt,!0),removeEventListener("prerenderingchange",jt,!0))},Bt=function(){addEventListener("visibilitychange",jt,!0),addEventListener("prerenderingchange",jt,!0)},Ut=[1800,3e3],Wt=[.1,.25],Gt=0,Kt=1/0,Xt=0,Vt=0,Jt=(en.prototype.p=function(){Vt=xt(),this.u.length=0,this.l.clear()},en.prototype.P=function(){var e=Math.min(this.u.length-1,Math.floor((xt()-Vt)/50));return this.u[e]},en.prototype.h=function(e){if(null!=(t=this.m)&&t.call(this,e),e.interactionId||"first-input"===e.entryType){var t=this.u.at(-1),n=this.l.get(e.interactionId);if(n||this.u.length<10||e.duration>t.T){if(n?e.duration>n.T?(n.entries=[e],n.T=e.duration):e.duration===n.T&&e.startTime===n.entries[0].startTime&&n.entries.push(e):(n={id:e.interactionId,entries:[e],T:e.duration},this.l.set(n.id,n),this.u.push(n)),this.u.sort((function(e,t){return t.T-e.T})),10<this.u.length)for(var r=0,o=this.u.splice(10);r<o.length;r++){var i=o[r];this.l.delete(i.id)}null!=(t=this.v)&&t.call(this,n)}}},en),zt=[200,500],Qt=(Zt.prototype.h=function(e){var t;null!=(t=this.m)&&t.call(this,e)},Zt),Yt=[2500,4e3],$t=(new We({name:y.WEB_VITALS}),{FCP:-1,LCP:-1,CLS:-1,INP:-1});function Zt(){}function en(){this.u=[],this.l=new Map}function tn(){this.i=0,this.o=[]}function nn(e,t){for(var n=new cn(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];var o=new un(n[30]);for(r=1;r<30;++r)for(var i=n[r];i<n[r+1];++i)o[i]=i-n[r]<<5|r;return{b:n,r:o}}var rn=new We({name:y.WEB_VITALS,onNewAegis:function(e){if(rt()&&"function"==typeof window.PerformanceObserver&&"function"==typeof performance.getEntriesByName)try{Pt(Mt),i=Mt,void 0===s&&(s={}),At((function(){function e(e){for(var o=0,i=e=s.reportAllChanges?e:e.slice(-1);o<i.length;o++){var c=i[o];r.h(c),c.startTime<t.firstHiddenTime&&(n.value=Math.max(c.startTime-Rt(),0),n.entries=[c],a())}}var t=kt(),n=nt("LCP"),r=Ct(s,Qt),o=It("largest-contentful-paint",e);if(o){for(var a=et(i,n,Yt,s.reportAllChanges),c=Lt((function(){e(o.takeRecords()),o.disconnect(),a(!0)})),u=0,l=["keydown","click","visibilitychange"];u<l.length;u++)addEventListener(l[u],(function(){return _t(c)}),{capture:!0,once:!0});St((function(e){n=nt("LCP"),a=et(i,n,Yt,s.reportAllChanges),tt((function(){n.value=performance.now()-e.timeStamp,a(!0)}))}))}})),r=Mt,void 0===o&&(o={}),Pt(Lt((function(){function e(e){for(var r=0,o=e;r<o.length;r++){var s=o[r];i.h(s)}i.i>n.value&&(n.value=i.i,n.entries=i.o,t())}var t,n=nt("CLS",0),i=Ct(o,qt),s=It("layout-shift",e);s&&(t=et(r,n,Wt,o.reportAllChanges),document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState&&(e(s.takeRecords()),t(!0))})),St((function(){i.i=0,n=nt("CLS",0),t=et(r,n,Wt,o.reportAllChanges),tt((function(){return t()}))})),setTimeout(t))}))),t=Mt,void 0===n&&(n={}),globalThis.PerformanceEventTiming&&"interactionId"in PerformanceEventTiming.prototype&&At((function(){var e;function r(e){_t((function(){for(var t=0,n=e;t<n.length;t++){var r=n[t];i.h(r)}var s=i.P();s&&s.T!==o.value&&(o.value=s.T,o.entries=s.entries,a())}))}"interactionCount"in performance||(Dt=Dt||It("event",Nt,{type:"event",buffered:!0,durationThreshold:0}));var o=nt("INP"),i=Ct(n,Jt),s=It("event",r,{durationThreshold:null!=(e=n.durationThreshold)?e:40}),a=et(t,o,zt,n.reportAllChanges);s&&(s.observe({type:"first-input",buffered:!0}),document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState&&(r(s.takeRecords()),a(!0))})),St((function(){i.p(),o=nt("INP"),a=et(t,o,zt,n.reportAllChanges)})))})),Je(this.publishVitals.bind(this,e),!0)}catch(e){}var t,n,r,o,i,s},publishVitals:function(e){var t=this;setTimeout((function(){t.publish(u({type:T.WEB_VITALS,msg:"web_vitals"},$t),e)}),10)},destroy:function(){this.publish=function(){}}}),on=(new We({name:y.SPA}),new We({name:y.SPA,originFireUrl:"",onNewAegis:function(e){var t,n,r,o=this;this.sendPv=this.sendPv.bind(this),null!=(t=null==(t=e.config)?void 0:t.plugin)&&t.spa&&this.sendPv(e);try{null!=(n=Object.getOwnPropertyDescriptor(History.prototype,"pushState"))&&n.writable&&(history.pushState=this.wr("pushState")||history.pushState),null!=(r=Object.getOwnPropertyDescriptor(History.prototype,"replaceState"))&&r.writable&&(history.replaceState=this.wr("replaceState")||history.replaceState)}catch(e){}["replaceState","pushState","hashchange","popstate"].forEach((function(t){return window.addEventListener(t,(function(){return o.sendPv.call(o,e)}))}))},wr:function(e){var t=history[e],n="__".concat(e).concat("__hasWrittenByTamSpa");return"function"==typeof t&&!history[n]&&(Object.defineProperty(history,n,{value:!0,enumerable:!1}),function(){var n=t.apply(this,arguments),r=null;return"function"==typeof Event?r=new Event(e):(r=document.createEvent("HTMLEvents")).initEvent(e,!1,!0),r&&window.dispatchEvent(r),n})},sendPv:function(e){var t=this;setTimeout((function(){var n,r,o=location.pathname+location.hash+e.config.id;o&&o!==e.originFireUrl&&(r=(null==(r=null==(r=e.config)?void 0:r.plugin)?void 0:r.spa).onRouterChange,e.updateSnapshootInfo(u({from:e.getCurrentPageUrl()},null==r?void 0:r())),e.timeOrigin=Date.now(),r={msg:"spa",type:T.PV,plugin:t.name},null!=(n=e.config)&&n.sendPvImmediately?e.sendLogsImmediately([r]):t.publish(r,e),e.originFireUrl=o)}),0)},destroy:function(){this.sendPv=function(){}}})),sn={name:"networkRefresh",create:function(e){return function(t){return new Promise((function(n){dt((function(r){e.extendBean({netType:r}),n(t)}))}))}}},an=Uint8Array,cn=Uint16Array,un=Int32Array,ln=new an([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),fn=new an([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),dn=new an([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),pn=(jn=nn(ln,2)).b,hn=jn.r;pn[28]=258,hn[258]=28;for(var gn=nn(fn,0).r,vn=new cn(32768),mn=0;mn<32768;++mn){var yn=(61680&(yn=(52428&(yn=(43690&mn)>>1|(21845&mn)<<1))>>2|(13107&yn)<<2))>>4|(3855&yn)<<4;vn[mn]=((65280&yn)>>8|(255&yn)<<8)>>1}var wn=function(e,t,n){for(var r=e.length,o=0,i=new cn(t);o<r;++o)e[o]&&++i[e[o]-1];var s=new cn(t);for(o=1;o<t;++o)s[o]=s[o-1]+i[o-1]<<1;if(n){var a=new cn(1<<t),c=15-t;for(o=0;o<r;++o)if(e[o])for(var u=o<<4|e[o],l=t-e[o],f=s[e[o]-1]++<<l,d=f|(1<<l)-1;f<=d;++f)a[vn[f]>>c]=u}else for(a=new cn(r),o=0;o<r;++o)e[o]&&(a[o]=vn[s[e[o]-1]++]>>15-e[o]);return a},bn=new an(288);for(mn=0;mn<144;++mn)bn[mn]=8;for(mn=144;mn<256;++mn)bn[mn]=9;for(mn=256;mn<280;++mn)bn[mn]=7;for(mn=280;mn<288;++mn)bn[mn]=8;var En=new an(32);for(mn=0;mn<32;++mn)En[mn]=5;function Sn(e,t,n){var r=t/8|0;e[r]|=n<<=7&t,e[1+r]|=n>>8}function Tn(e,t,n){var r=t/8|0;e[r]|=n<<=7&t,e[1+r]|=n>>8,e[2+r]|=n>>16}function Rn(e,t){for(var n=[],r=0;r<e.length;++r)e[r]&&n.push({s:r,f:e[r]});var o=n.length,i=n.slice();if(!o)return{t:Mn,l:0};if(1==o)return(g=new an(n[0].s+1))[n[0].s]=1,{t:g,l:1};n.sort((function(e,t){return e.f-t.f})),n.push({s:-1,f:25001});var s=n[0],a=n[1],c=0,u=1,l=2;for(n[0]={s:-1,f:s.f+a.f,l:s,r:a};u!=o-1;)s=n[n[c].f<n[l].f?c++:l++],a=n[c!=u&&n[c].f<n[l].f?c++:l++],n[u++]={s:-1,f:s.f+a.f,l:s,r:a};var f=i[0].s;for(r=1;r<o;++r)i[r].s>f&&(f=i[r].s);var d=new cn(f+1),p=Nn(n[u-1],d,0);if(t<p){r=0;var h=0,g=p-t,v=1<<g;for(i.sort((function(e,t){return d[t.s]-d[e.s]||e.f-t.f}));r<o;++r){var m=i[r].s;if(!(d[m]>t))break;h+=v-(1<<p-d[m]),d[m]=t}for(h>>=g;0<h;){var y=i[r].s;d[y]<t?h-=1<<t-d[y]++-1:++r}for(;0<=r&&h;--r){var w=i[r].s;d[w]==t&&(--d[w],++h)}p=t}return{t:new an(d),l:p}}function On(e){for(var t=e.length;t&&!e[--t];);for(var n=new cn(++t),r=0,o=e[0],i=1,s=function(e){n[r++]=e},a=1;a<=t;++a)if(e[a]==o&&a!=t)++i;else{if(!o&&2<i){for(;138<i;i-=138)s(32754);2<i&&(s(10<i?i-11<<5|28690:i-3<<5|12305),i=0)}else if(3<i){for(s(o),--i;6<i;i-=6)s(8304);2<i&&(s(i-3<<5|8208),i=0)}for(;i--;)s(o);i=1,o=e[a]}return{c:n.subarray(0,r),n:t}}function Cn(e,t){for(var n=0,r=0;r<t.length;++r)n+=e[r]*t[r];return n}function In(e,t,n){for(;n;++t)e[t]=n,n>>>=8}function Ln(e,t,n,r,o,i,s,a,c,u,l){Sn(t,l++,n),++o[256];for(var f=(n=Rn(o,15)).t,d=(n=n.l,(p=Rn(i,15)).t),p=p.l,h=(g=On(f)).c,g=g.n,v=(m=On(d)).c,m=m.n,y=new cn(19),w=0;w<h.length;++w)++y[31&h[w]];for(w=0;w<v.length;++w)++y[31&v[w]];for(var b=(E=Rn(y,7)).t,E=E.l,S=19;4<S&&!b[dn[S-1]];--S);var T=u+5<<3,R=Cn(o,bn)+Cn(i,En)+s;if(o=Cn(o,f)+Cn(i,d)+s+14+3*S+Cn(y,b)+2*y[16]+3*y[17]+7*y[18],0<=c&&T<=R&&T<=o)return xn(t,l,e.subarray(c,c+u));if(Sn(t,l,1+(o<R)),l+=2,o<R){var O=wn(f,n,0),C=f,I=wn(d,p,0),L=d,k=wn(b,E,0);for(Sn(t,l,g-257),Sn(t,l+5,m-1),Sn(t,l+10,S-4),l+=14,w=0;w<S;++w)Sn(t,l+3*w,b[dn[w]]);l+=3*S;for(var A=[h,v],P=0;P<2;++P){var N=A[P];for(w=0;w<N.length;++w){var x=31&N[w];Sn(t,l,k[x]),l+=b[x],15<x&&(Sn(t,l,N[w]>>5&127),l+=N[w]>>12)}}}else O=kn,C=bn,I=An,L=En;for(w=0;w<a;++w){var _,M=r[w];255<M?(Tn(t,l,O[257+(x=M>>18&31)]),l+=C[x+257],7<x&&(Sn(t,l,M>>23&31),l+=ln[x]),Tn(t,l,I[_=31&M]),l+=L[_],3<_&&(Tn(t,l,M>>5&8191),l+=fn[_])):(Tn(t,l,O[M]),l+=C[M])}return Tn(t,l,O[256]),l+C[256]}var kn=wn(bn,9,0),An=wn(En,5,0),Pn=function(e){return(e+7)/8|0},Nn=function(e,t,n){return-1==e.s?Math.max(Nn(e.l,t,n+1),Nn(e.r,t,n+1)):t[e.s]=n},xn=function(e,t,n){var r=n.length,o=Pn(t+2);e[o]=255&r,e[o+1]=r>>8,e[o+2]=255^e[o],e[o+3]=255^e[o+1];for(var i=0;i<r;++i)e[o+i+4]=n[i];return 8*(o+4+r)},_n=new un([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Mn=new an(0),Dn=(()=>{for(var e=new Int32Array(256),t=0;t<256;++t){for(var n=t,r=9;--r;)n=(1&n&&-306674912)^n>>>1;e[t]=n}return e})();function qn(e,t){t=t||{};var n=-1,r=e.length;!function(e){for(var t=n,r=0;r<e.length;++r)t=Dn[255&t^e[r]]^t>>>8;n=t}(e);var o=(e=((e,t,n,r)=>{!r&&(r={l:1},t.dictionary)&&(s=t.dictionary.subarray(-32768),(i=new an(s.length+e.length)).set(s),i.set(e,s.length),e=i,r.w=s.length);var o=e,i=null==t.level?6:t.level,s=null==t.mem?r.l?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):20:12+t.mem,a=(e=n,t=8,(n=r).z||o.length),c=(r=new an(e+a+5*(1+Math.ceil(a/7e3))+t)).subarray(e,r.length-t),u=n.l,l=7&(n.r||0);if(i){l&&(c[0]=n.r>>3);for(var f=(i=_n[i-1])>>13,d=8191&i,p=(1<<s)-1,h=n.p||new cn(32768),g=n.h||new cn(1+p),v=Math.ceil(s/3),m=2*v,y=function(e){return(o[e]^o[e+1]<<v^o[e+2]<<m)&p},w=new un(25e3),b=new cn(288),E=new cn(32),S=0,T=0,R=n.i||0,O=0,C=n.w||0,I=0;R+2<a;++R){var L=y(R),k=32767&R,A=g[L];if(h[k]=A,g[L]=k,C<=R){var P=a-R;if((7e3<S||24576<O)&&(423<P||!u)){l=Ln(o,c,0,w,b,E,T,O,I,R-I,l),O=S=T=0,I=R;for(var N=0;N<286;++N)b[N]=0;for(N=0;N<30;++N)E[N]=0}var x=2,_=0,M=d,D=k-A&32767;if(2<P&&L==y(R-D))for(var q=Math.min(f,P)-1,F=Math.min(32767,R),H=Math.min(258,P);D<=F&&--M&&k!=A;){if(o[R+x]==o[R+x-D]){for(var j=0;j<H&&o[R+j]==o[R+j-D];++j);if(x<j){if(_=D,q<(x=j))break;var B=Math.min(D,j-2),U=0;for(N=0;N<B;++N){var W=R-D+N&32767,G=W-h[W]&32767;U<G&&(U=G,A=W)}}}D+=(k=A)-(A=h[k])&32767}_?(w[O++]=268435456|hn[x]<<18|gn[_],L=31&hn[x],P=31&gn[_],T+=ln[L]+fn[P],++b[257+L],++E[P],C=R+x,++S):(w[O++]=o[R],++b[o[R]])}}for(R=Math.max(R,C);R<a;++R)w[O++]=o[R],++b[o[R]];l=Ln(o,c,u,w,b,E,T,O,I,R-I,l),u||(n.r=7&l|c[l/8|0]<<3,l-=7,n.h=g,n.p=h,n.i=R,n.w=C)}else{for(R=n.w||0;R<a+u;R+=65535){var K=R+65535;a<=K&&(c[l/8|0]=u,K=a),l=xn(c,l+1,o.subarray(R,K))}n.i=a}return i=r,s=0,(null==(n=e+Pn(l)+t)||n>i.length)&&(n=i.length),new an(i.subarray(s=null==s||s<0?0:s,n))})(e,t,10+((e=t).filename?e.filename.length+1:0))).length,i=e,s=t.filename;if(i[0]=31,i[1]=139,i[2]=8,i[8]=t.level<2?4:9==t.level?2:0,i[9]=3,0!=t.mtime&&In(i,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),s){i[3]=8;for(var a=0;a<=s.length;++a)i[a+10]=s.charCodeAt(a)}return In(e,o-8,~n),In(e,o-4,r),e}jn="undefined"!=typeof TextDecoder&&new TextDecoder;try{jn.decode(Mn,{stream:!0})}catch(Et){}function Fn(e){return-1!==navigator.userAgent.toLowerCase().indexOf(e)}pn=(e=>{function t(t){var n;(t=e.call(this,t)||this).sendNow=!1,t.originFireUrl="",t.timeOrigin=null!=(n="undefined"!=typeof performance&&(null==performance?void 0:performance.timeOrigin))?n:Date.now(),t.pipes.push(sn);try{t.updateSnapshootInfo({from:t.getCurrentPageUrl()}),"undefined"!=typeof document&&t.extendBean({referer:document.referrer||""}),t.init()}catch(n){t.logger.warn(n),t.sendSDKError({msg:Y(n)})}return t}var n=t,r=e;if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function o(){this.constructor=n}return c(n,r),n.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o),t.prototype.getCurrentPageUrl=function(){var e=this.config.pageUrl||location.href||"";return(e="function"==typeof this.config.urlHandler?this.config.urlHandler():e).slice(0,2048)},t.prototype.compressLogs=function(e){var t=e;e={payload:t,isCompressed:!1};try{return TextEncoder&&"undefined"!=typeof TextEncoder?{payload:qn((new TextEncoder).encode(t),{level:1}),isCompressed:!0}:e}catch(t){return e}},t.prototype.performRequest=function(e,t,n){var r=e.method,o=e.url,i=e.payload;if(e=void 0===(e=e.headers)?{}:e,this.sendNow&&o===te(this.config,"hostUrl.url")&&"function"==typeof(null==navigator?void 0:navigator.sendBeacon))return(a=navigator.sendBeacon(o,$(i)))?null==t?void 0:t(a):null==n?void 0:n(a);var s={url:o,payload:i,method:r,headers:e,success:t,fail:n},a=s.url,c=(o=s.method,i=s.payload,s.headers),u=s.fail,l=s.success;try{var f=new XMLHttpRequest;f.sendByAegis=!0,f.addEventListener("readystatechange",(function(){4===f.readyState&&(400<=f.status||0===f.status?null!=u&&u(f.response):null!=l&&l(f.response))})),f.open(o||"post",a),Object.keys(c).forEach((function(e){f.setRequestHeader(e,c[e])})),f.send(i)}catch(s){null!=u&&u({})}},t.sessionID="session-".concat(Date.now()),t})(Ue);var Hn=(new We({name:y.IE}),{}),jn=(Hn.macos=function(){return Fn("mac")},Hn.ios=function(){return Hn.iphone()||Hn.ipod()||Hn.ipad()},Hn.iphone=function(){return!Hn.windows()&&Fn("iphone")},Hn.ipod=function(){return Fn("ipod")},Hn.ipad=function(){var e="MacIntel"===navigator.platform&&1<navigator.maxTouchPoints;return Fn("ipad")||e},Hn.android=function(){return!Hn.windows()&&Fn("android")},Hn.androidPhone=function(){return Hn.android()&&Fn("mobile")},Hn.androidTablet=function(){return Hn.android()&&!Fn("mobile")},Hn.blackberry=function(){return Fn("blackberry")||Fn("bb10")},Hn.blackberryPhone=function(){return Hn.blackberry()&&!Fn("tablet")},Hn.blackberryTablet=function(){return Hn.blackberry()&&Fn("tablet")},Hn.windows=function(){return Fn("windows")},Hn.windowsPhone=function(){return Hn.windows()&&Fn("phone")},Hn.windowsTablet=function(){return Hn.windows()&&Fn("touch")&&!Hn.windowsPhone()},Hn.fxos=function(){return(Fn("(mobile")||Fn("(tablet"))&&Fn(" rv:")},Hn.fxosPhone=function(){return Hn.fxos()&&Fn("mobile")},Hn.fxosTablet=function(){return Hn.fxos()&&Fn("tablet")},Hn.meego=function(){return Fn("meego")},Hn.cordova=function(){return window.cordova&&"file:"===window.location.protocol},Hn.nodeWebkit=function(){return"object"==typeof window.process},Hn.mobile=function(){return Hn.androidPhone()||Hn.iphone()||Hn.ipod()||Hn.windowsPhone()||Hn.blackberryPhone()||Hn.fxosPhone()||Hn.meego()},Hn.tablet=function(){return Hn.ipad()||Hn.androidTablet()||Hn.blackberryTablet()||Hn.windowsTablet()||Hn.fxosTablet()},Hn.desktop=function(){return!Hn.tablet()&&!Hn.mobile()},Hn.isIE=function(){return"ActiveXObject"in window},new We({name:y.CLOSE}),new We({name:y.CLOSE,onNewAegis:function(e){var t,n=this;Hn.desktop()?(t=window.onunload,window.onunload=function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];n.publishNotReportedLog(e),null!=t&&t.call.apply(t,p([window],r,!1))}):Je(this.publishNotReportedLog.bind(this,e),!0)},publishNotReportedLog:function(e){e.clearPluginCache(),e.clearThrottleCache()},publishThrottlePipeLogs:function(){}}));function Bn(e,t,n){return null!=t&&t.length&&"object"==typeof e?t.reduce((function(t,r){var o=e instanceof Headers?e.get(r):e[r];return o?t+"".concat(""===t?"\n":"\n\n").concat(n," header ").concat(r,": ").concat(o):t}),""):""}function Un(e){var t=e.isAjaxError,n=(e=e.isRetcodeError,S.INFO);return t?n=S.AJAX_ERROR:e&&(n=S.ERROR),{level:n,type:T.API}}function Wn(){}new We({name:y.F_ID}),Ue=new We({name:y.PV,init:function(e){var t,n;null!=(n=null==(n=e.config)?void 0:n.plugin)&&n.spa||(n={msg:"pv",type:T.PV,plugin:this.name},null!=(t=e.config)&&t.sendPvImmediately?e.sendLogsImmediately([n]):this.publish(n,e))}});var Gn,Kn,Xn,Vn,Jn,zn,Qn="abort",Yn="error",$n="timeout",Zn="text/event-stream",er={isSSE:void 0,dataChunkCount:0,sseConnectTime:0,firstChunkTime:0,totalDataSize:0,tokenIntervalArr:[],preTokenStartTime:0,chunkPosition:0,firstChunkFlag:!1},tr="content-type",nr=!1,rr=[],or=/^\/[^/]/,ir=!1,sr=[],ar=(new We({name:y.API}),new We({name:y.API,pipes:["repeatLimit","networkRefresh"],override:!1,onNewAegis:function(e){var t,n=((null==(n=null==e?void 0:e.config)?void 0:n.plugin)||{}).api;null!=n&&n.injectTraceHeader?this.traceRequestHeader=new W(n.injectTraceHeader,null!=(t=null==n?void 0:n.injectTraceIgnoreUrls)?t:[],null==n?void 0:n.injectTraceUrls):this.traceRequestHeader=null,this.overrideFetch(e.config,e),this.overrideXhr(e.config,e)},overrideFetch:function(e,t){var n=this,r=void 0===(y=((null==e?void 0:e.plugin)||{}).api)?{}:y,o=r.resourceTypeHandler,i=void 0===(y=r.reqHeaders)?[]:y,s=void 0===(y=r.resHeaders)?[]:y,a=r.apiDetail,c=r.reqParamHandler,p=r.resBodyHandler,h=void 0===(y=r.reportWhenError)||y,g=r.isSSE,v=r.urlHandler,m=r.urlRewrite,y={name:e.id,config:e,traceRequestHeader:this.traceRequestHeader,urlRewrite:function(t){return(null==m?void 0:m(t,e))||t},then:function(e,m,y,w){return f(n,void 0,void 0,(function(){var n,b,E,S,R,O,C,I,L,k,A,P,N,x=this;return d(this,(function(_){switch(_.label){case 0:switch(n=(P=w||{}).headers,b=P.body,E=P.method,S=(P=e||{}).headers,R=P.status,P=null!=(P=null==S?void 0:S.get(tr))?P:"",O=J(y,P,o)){case"api":return[3,1];case"static":return[3,6]}return[3,7];case 1:return C={},I="",(L=(null==P?void 0:P.includes(Zn))||(null==g?void 0:g(y)))?[4,(M=null==(N=null==(N=e.clone())?void 0:N.body)?void 0:N.getReader(),D=m,q=r.isFirstSSEChunk,f(void 0,void 0,void 0,(function(){var e,t,n,r,o,i,s,a,c,u,l,f,p;return d(this,(function(d){switch(d.label){case 0:e=Date.now(),t=e,n=new Uint8Array(0),r=0,o=D,i=[],s=new TextDecoder,a=!1,d.label=1;case 1:return[4,M.read()];case 2:return!(l=d.sent()).done&&l.value?(u=Date.now()-t,!a&&(c=ie(s.decode(l.value)),"function"==typeof q?q(c):0===n.length)&&(o+=u,a=!0),i.push(u),t=Date.now(),r+=1,h=n,g=l.value,(v=new Uint8Array(h.length+g.length)).set(h),v.set(g,h.length),n=v,[3,1]):[3,3];case 3:return c=Date.now()-e,u=c+D,l=oe(i),f=l.fluency,p=l.isStuck,[2,{dataDuration:c,dataChunkCount:r,firstChunkTime:o,totalDuration:u,totalDataSize:n.length,connectTime:D,fluency:f,isStuck:p,data:s.decode(n)}]}var h,g,v}))})))]:[3,3];case 2:return N=_.sent(),k=N.data,A=l(N,["data"]),C=A,I=k,[3,5];case 3:return[4,e.clone().text()];case 4:I=_.sent(),_.label=5;case 5:return setTimeout((function(){return f(x,void 0,void 0,(function(){var o,f,g,w,T,k,A,P,N,x,_,M,D,q,F;return d(this,(function(d){switch(d.label){case 0:return f=this.getPerformanceEntryByUrl({url:y,duration:m}),o=f.performanceTiming,f=l(f,["performanceTiming"]),[4,z(I,r,{url:y,ctx:e,payload:b})];case 1:return w=d.sent(),g=w.code,w=w.isErr,x=(T=R<=0||400<=R)||w,ae({isWhiteList:t.isWhiteList,requestUrl:y,config:t.config,isErrorApi:x,reportWhenError:h})&&(A=ce({isWhiteList:t.isWhiteList,requestUrl:y,apiConfig:r,apiDetail:a,isErrorApi:x,reportWhenError:h}),k=A?Q(b,c,{url:y}):"",A=A?Q(I,p,{url:y,ctx:e}):"",P=K("function"==typeof v?v(y,b):y),N="".concat(T?"FETCH_ERROR":ne({url:P,bodyTxt:A,status:R,code:g})),x=x?"".concat(y,",").concat(g):void 0,_=Bn(n,i,"req"),M=Bn(S,s,"res"),q=j(n),D=q[0],q=q[1],F=function(){return u({isSSE:L},L?u(u({},C),{totalDuration:o.duration}):{})},this.publish(u(u(u(u({},o),Un({isAjaxError:T,isRetcodeError:w})),{msg:N,errorMsg:x,url:P,status:R||0,method:E||"get",ret:g,isErr:w,param:k,data:A,reqHeaders:_,resHeaders:M,trace:D,span:q,nextHopProtocol:f.nextHopProtocol,requestType:O}),F()),t)),[2]}}))}))}),0),[3,7];case 6:return setTimeout((function(){var e=(n=x.getPerformanceEntryByUrl({url:y,duration:m})).performanceTiming,n=l(n,["performanceTiming"]);x.publish(u(u(u({},e),n),{status:R,url:K(y),type:T.ASSETS_SPEED}),t)}),0),[3,7];case 7:return[2]}var M,D,q}))}))},catch:function(r,s,a,f){var d,p=(f=f||{}).headers,m=f.body,y=f.method;throw!Z(a,te(e,"hostUrl"))&&h&&(d=J(a,"",o),setTimeout((function(){var e=n.getPerformanceEntryByUrl({url:a,duration:s}),o=e.performanceTiming,f=l(e,["performanceTiming"]);switch(d){case"api":var h="FETCH_ERROR: ".concat(r," \nurl: ").concat(a,"\nresdata: \nstatus: 0\nretcode: unknown\n "),w="function"==typeof v?v(a,m):a,b=(E=j(p))[0],E=E[1],S=Bn(p,i,"req"),R=Q(m,c,{url:a});n.publish(u(u(u({},o),Un({isAjaxError:!0,isRetcodeError:!1})),{msg:h,errorMsg:"".concat(a,",0"),url:K(w),status:0,method:y||"get",param:R,reqHeaders:S,ret:"unknown",trace:b,span:E,isSSE:null==g?void 0:g(),nextHopProtocol:f.nextHopProtocol,requestType:d}),t);break;case"static":n.publish(u(u(u({},o),f),{url:K(a),status:400,type:T.ASSETS_SPEED}),t)}}),0)),r}};this.hackFetchOptions=y,function(e){sr.find((function(t){return t.name===e.name}))||(sr.push(e),!ir&&window.fetch&&(ir=!0,Vn=window.fetch,window.fetch=function(t,n){void 0===n&&(n={});var r,o,i,s="string"==typeof(a=t)?a:a instanceof Request?a.url:a instanceof URL?a.href:"",a=(or.test(s)&&(s="".concat(location.origin).concat(s)),t);return null!=(o=null==Se?void 0:Se.test)&&o.call(Se,s)?Vn(s,n):(o=Z(s,te(e.config,"hostUrl")),null!=e&&e.urlRewrite&&!o&&(s=(null==(o=null==e?void 0:e.urlRewrite)?void 0:o.call(e,s))||s,"string"==typeof t?a=s:t instanceof Request?(o=t.clone(),a=new Request(s,o)):t instanceof URL&&(a=new URL(s))),(o=(e||{}).traceRequestHeader)&&(t=((e,t)=>{try{var n={};return t.headers?new Headers(t.headers).forEach((function(e,t){n[t]=e})):e instanceof Request&&e.headers.forEach((function(e,t){n[t]=e})),n}catch(e){return console.log("failed to get header: ".concat(JSON.stringify(e)," }")),{}}})(t,n),r=(o=o.generate(s,t)||{}).name,o=o.value)&&r&&(n.headers=Object.assign(t,((t={})[r]=o,t))),i=Date.now(),Vn(a,n).then((function(e){for(var t=e.clone(),r=0;r<sr.length;r++){var o=sr[r];try{"function"==typeof o.then&&o.then(t,Date.now()-i,s,n)}catch(e){}}return t})).catch((function(e){for(var t=0;t<sr.length;t++){var r=sr[t];try{"function"==typeof r.catch&&r.catch(e,Date.now()-i,s,n)}catch(e){}}throw e})))}))}(this.hackFetchOptions)},overrideXhr:function(e,t){var n,r=this,o=((null==e?void 0:e.plugin)||{}).api,i=o.resourceTypeHandler,s=o.isFirstSSEChunk,a=o.isSSE,c=o.reportAbort,p=void 0===(E=o.reqHeaders)?[]:E,h=void 0===(E=o.resHeaders)?[]:E,g=o.resBodyHandler,v=o.reqParamHandler,m=o.apiDetail,y=void 0===(E=o.reportWhenError)||E,w=o.urlHandler,b=o.urlRewrite,E={traceRequestHeader:this.traceRequestHeader,name:e.id,config:e,urlRewrite:function(t){return(null==b?void 0:b(t,e))||t},send:function(e,n){function b(){return e.failType=Qn}function E(){return e.failType=Yn}function S(){return e.failType=$n}var R,O,C=Date.now();r.traceRequestHeader&&(R=(O=r.traceRequestHeader.generate(e.aegisUrl)||{}).name,O=O.value,R)&&O&&e.setRequestHeader(R,O),e.sseConfig=u({},er),e.addEventListener("readystatechange",(function(){var t=e,n=C,r=s,o=a;switch(t.readyState){case XMLHttpRequest.HEADERS_RECEIVED:(i=t.sseConfig).sseConnectTime;var i=i.preTokenStartTime;(f=Boolean(null==(f=t.getResponseHeader("content-type"))?void 0:f.includes(Zn))||(null==o?void 0:o(t.aegisUrl)))&&(c=Date.now()-n,i=Date.now(),be(t.sseConfig,{isSSE:f,sseConnectTime:c,preTokenStartTime:i}));break;case XMLHttpRequest.LOADING:if(!t.sseConfig.isSSE)return;var c=(f=t.sseConfig).dataChunkCount,u=f.firstChunkTime,l=f.totalDataSize,f=(i=f.preTokenStartTime,t.sseConfig.firstChunkFlag),d=t.sseConfig.tokenIntervalArr,p=(c+=1,Date.now()-i);!f&&(f=ie((t.responseText||"").slice(l)),"function"==typeof r?r(f):0===c)&&(u=Date.now()-n,be(t.sseConfig,{firstChunkFlag:!0})),i=Date.now(),d.push(p),l=(null==(f=t.responseText)?void 0:f.length)||0,be(t.sseConfig,{dataChunkCount:c,firstChunkTime:u,totalDataSize:l,tokenIntervalArr:d,preTokenStartTime:i})}})),e.addEventListener("loadend",(function(){setTimeout((function(){return f(r,void 0,void 0,(function(){var r,s,a,f,R,O,I,L,k,A,P,N,x,_,M,D,q,F,H;return d(this,(function(d){switch(d.label){case 0:switch(r=e.aegisUrl||"",a=Date.now()-C,H=null!=(H=e.getResponseHeader(tr))?H:"",H=J(r,H,i),a=this.getPerformanceEntryByUrl({url:r,duration:a}),s=a.performanceTiming,a=l(a,["performanceTiming"]),f=e.status,H){case"api":return[3,1];case"static":return[3,5]}return[3,6];case 1:return d.trys.push([1,3,,4]),[4,z(e.response,o,{url:r,ctx:e,payload:n})];case 2:return O=d.sent(),R=O.code,O=O.isErr,I="",(e.failType||!e.status||400<=e.status)&&(I=e.failType||"failed"),N=Boolean(I)||O,k=!c&&e.failType===Qn,!ae({isWhiteList:t.isWhiteList,requestUrl:r,config:t.config,isErrorApi:N,reportWhenError:y})||k?[2]:(k=ce({isWhiteList:t.isWhiteList,requestUrl:r,apiConfig:o,apiDetail:m,isErrorApi:N,reportWhenError:y}),L=k?Q(n,v,{url:r}):"",k=k?Q(e.response,g,{url:r}):"",A=K("function"==typeof w?w(r,n):r),P=I?"AJAX_ERROR: request ".concat(I):ne({url:r,bodyTxt:k,status:f,code:R}),N=N?"".concat(r,",").concat(R):void 0,x=Bn(e.aegisXhrReqHeaderV2,p,"req"),Z=e.getAllResponseHeaders(),_=Bn(Z.split("\r\n").reduce((function(e,t){return(t=t.split(": "))[0]&&t[1]&&(e[t[0]]=t[1]),e}),{}),h,"res"),D=j(e.aegisXhrReqHeaderV2),M=D[0],D=D[1],q=e.sseConfig.isSSE,F=q?u(u({},(Z=C,W=(U=(B=e).sseConfig).dataChunkCount,G=U.firstChunkTime,X=U.sseConnectTime,V=U.totalDataSize,U=U.tokenIntervalArr,$=(Y=Date.now())-(Z+X),Y-=Z,U=(Z=oe(U)).fluency,{totalDuration:Y,dataDuration:$,connectTime:X,firstChunkTime:G,dataChunkCount:W,totalDataSize:(null==(Y=B.responseText)?void 0:Y.length)||V,fluency:U,isStuck:Z=Z.isStuck})),{totalDuration:s.duration}):{},this.publish(u(u(u(u({},s),Un({isAjaxError:Boolean(I),isRetcodeError:O})),{msg:P,errorMsg:N,url:A,status:f,method:e.aegisMethod||"get",param:L,data:k,reqHeaders:x,resHeaders:_,ret:R,isErr:O,trace:M,span:D,nextHopProtocol:a.nextHopProtocol,requestType:H,isSSE:q}),F),t),[3,4]);case 3:return d.sent(),[3,4];case 4:return[3,6];case 5:return this.publish(u(u(u({},s),a),{status:f,url:K(r),type:T.ASSETS_SPEED}),t),[3,6];case 6:return e.removeEventListener(Qn,b),e.removeEventListener(Yn,E),e.removeEventListener($n,S),[2]}var B,U,W,G,X,V,Y,$,Z}))}))}),0)})),e.addEventListener(Qn,b),e.addEventListener(Yn,E),e.addEventListener($n,S)}};this.hackXHROptions=E,n=this.hackXHROptions,null!=(E=Object.getOwnPropertyDescriptor(XMLHttpRequest.prototype,"open"))&&E.writable&&!rr.find((function(e){return e.name===n.name}))&&(rr.push(n),!nr)&&window.XMLHttpRequest&&(Gn=window.XMLHttpRequest.prototype.send,Kn=window.XMLHttpRequest.prototype.open,Xn=window.XMLHttpRequest.prototype.setRequestHeader,nr=!0,window.XMLHttpRequest.prototype.open=function(){this.aegisMethod=arguments[0];var e,t=arguments[1];if(or.test(t)&&(t="".concat(location.origin).concat(t)),null!=n&&n.urlRewrite&&(Z(t=(null==(e=null==n?void 0:n.urlRewrite)?void 0:e.call(n,t))||t,te(n.config,"hostUrl"))||(arguments[1]=t)),this.aegisUrl=t,this.aegisXhrStartTime=Date.now(),this.sendByAegis)Hn.isIE()||(this.timeout=5e3);else for(var r=0;r<rr.length;r++){var o=rr[r];try{"function"==typeof o.open&&o.open(this)}catch(e){}}return Kn.apply(this,arguments)},window.XMLHttpRequest.prototype.setRequestHeader=function(){var e,t=arguments[0],r=arguments[1];if(this.aegisXhrReqHeaderV2=null!=(e=this.aegisXhrReqHeaderV2)?e:{},!(null!=n&&n.traceRequestHeader&&-1<["traceparent","b3","sw8","sentry-trace"].indexOf(t)&&(this.aegisXhrReqHeaderV2[t]||(arguments[1]=r),this.aegisXhrReqHeaderV2[t])))return this.aegisXhrReqHeaderV2[t]=arguments[1],Xn.apply(this,arguments)},window.XMLHttpRequest.prototype.send=function(){if(!this.sendByAegis)for(var e=0;e<rr.length;e++){var t=rr[e];try{"function"==typeof t.send&&t.send(this,arguments[0])}catch(e){}}return Gn.apply(this,arguments)})},getPerformanceEntryByUrl:function(e){var t=e.url;if(e=e.duration,"string"==typeof t&&"function"==typeof performance.getEntriesByName){var n=null==(n=performance.getEntriesByName(t))?void 0:n.pop();if(n)return{msg:"api",type:T.API,isHttps:V(t),nextHopProtocol:n.nextHopProtocol||"",urlQuery:K(t,!0),transferSize:0<n.transferSize?n.transferSize:-1,performanceTiming:Qe(n)}}return{msg:"api",type:T.API,isHttps:V(t),nextHopProtocol:"",urlQuery:K(t,!0),performanceTiming:{preHandleTime:B.number,duration:Number(e.toFixed(2)),domainLookup:B.number,connectTime:B.number,tlsTime:B.number,tcpAndRequestGap:B.number,requestTime:B.number,responseTime:B.number}}},destroy:function(){var e,t,n;this.publish=function(){},this.hackXHROptions&&(e=this.hackXHROptions,-1!==(n=rr.findIndex((function(t){return t.name===e.name}))))&&rr.splice(n,1),this.hackFetchOptions&&(t=this.hackFetchOptions,-1!==(n=sr.findIndex((function(e){return e.name===t.name}))))&&sr.splice(n,1),this.override=!1}})),cr=Jn={INITIAL_LOAD:"initial_load",ROUTE_CHANGE:"route_change"},ur="aegis_session_id",lr="link_session_id",fr="link_span_id";function dr(e,t,n){var r,o,i=n.before,s=n.after,a=(r=e)[o=t],c=a,u=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return i&&i.apply(this,t),"function"==typeof c&&(e=c.apply(this,t)),s&&s.apply(this,[e]),e};return r[o]=l,{stop:function(){r[o]===l?r[o]=a:u=a}};function l(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if("function"==typeof u)return u.apply(this,e)}}function pr(e){return function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return t.forEach((function(t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})),e}({},e)}function hr(e){return["ancestorOrigins","href","origin","protocol","host","hostname","port","pathname","search","hash","assign","reload","replace","toString"].reduce((function(t,n){return t[n]=e[n],t}),{})}function gr(){return(new Date).getTime()}function vr(e){var t;return e?(t=null==e?void 0:e.indexOf("?"))<0?e:null==e?void 0:e.slice(0,t):""}function mr(e,t){function n(e,t){for(var n=e,o=0;o<=10&&n&&!["BODY","HTML","HEAD"].includes(null==n?void 0:n.nodeName);){for(var i=0,s=t;i<s.length;i++){var a=(0,s[i])(n);if("string"==typeof a&&a.trim())return r(a.trim().replace(/\s+/g," "))}if("FORM"===(null==n?void 0:n.nodeName))break;n=n.parentElement,o+=1}return""}function r(e){return 100<e.length?"".concat((void 0===n&&(n=""),r=55296<=(r=(t=e).charCodeAt(99))&&r<=56319?101:100,t.length<=r?t:"".concat(null==t?void 0:t.slice(0,r)).concat(n))," [...]"):e;var t,n,r}var o,i=[function(e){var t;if(u()){if("labels"in e&&e.labels&&0<e.labels.length)return c(e.labels[0])}else if(e.id)return(t=e.ownerDocument&&(t=>{for(var n=0;n<t.length;n+=1){var r=t[n];if(r.htmlFor===e.id)return r}})(e.ownerDocument.querySelectorAll("label")))&&c(t);return""},function(e){if("INPUT"===(null==e?void 0:e.nodeName)){var t=e.getAttribute("type");if(["button","submit","reset"].includes(t||""))return e.value}return""},function(e){return["BUTTON","LABEL"].includes(null==e?void 0:e.nodeName)||"button"===e.getAttribute("role")?c(e):""},function(e){return e.getAttribute("aria-label")},function(e){var t=e.getAttribute("aria-labelledby");return t?t.split(/\s+/).map((function(t){return a(e,t)})).filter((function(e){return Boolean(e)})).map((function(e){return c(e)})).join(" "):""},function(e){return e.getAttribute("alt")},function(e){return e.getAttribute("name")},function(e){return e.getAttribute("title")},function(e){return e.getAttribute("placeholder")},function(e){var t;return"options"in e&&0<(null==(t=null==e?void 0:e.options)?void 0:t.length)?c(e.options[0]):""}],s=[function(e){return c(e)}],a=function(e,t){return e.ownerDocument?e.ownerDocument.getElementById(t):null},c=function(e){if(!e.isContentEditable)return"innerText"in e?e.innerText:e.textContent},u=function(){return o=void 0===o?"labels"in HTMLInputElement.prototype:o};return((e,t)=>{var n;if("closest"in HTMLElement.prototype)n=e.closest("[".concat(t,"]"));else for(var o=e;o;){if(o.hasAttribute(t)){n=o;break}o=(e=>{if(e.parentElement)return e.parentElement;for(;e.parentNode;){if(e.parentNode.nodeType===Node.ELEMENT_NODE)return e.parentNode;e=e.parentNode}return null})(o)}if(n)return r((e=n.getAttribute(t)).trim().replace(/\s+/g," "))})(e,t||"data-aegis-action-name")||n(e,i)||n(e,s)||""}function yr(){return{sessionId:q.generateTraceId(),sessionFrom:zn.SELF_GENETATE}}(cr=zn={}).SELF_GENETATE="self_generate",cr.SELF_INJECT="self_inject",cr.SERVER_INJECT="server_inject",cr.URL_QUERY="url_query",cr.LOCAL_STORAGE="local_storage",cr.COOKIES="cookies",Tr.prototype.subscribe=function(e){var t=this;return!this.observers.length&&this.onFirstSubscribe&&(this.onLastUnsubscribe=this.onFirstSubscribe(this)||void 0),this.observers.push(e),{unsubscribe:function(){t.observers=t.observers.filter((function(t){return e!==t})),!t.observers.length&&t.onLastUnsubscribe&&t.onLastUnsubscribe()}}},Tr.prototype.notify=function(e){this.observers.forEach((function(t){return t(e)}))};var wr,br=Tr,Er=(cr=new We({name:y.SESSION,onNewAegis:function(e){function t(t,r){w.publishSessionDataWithAegis({session_type:t,is_active:r,session_from:O,link_session_id:null==n?void 0:n.linkSessionId,link_span_id:null==n?void 0:n.linkSpanId},e)}var n,r,o,i,s,a,c,f,d,p,h,g,v,m,w=this,b=(null==(b=e.config.plugin)?void 0:b.session).actionTypes,E=null==(E=e.config.plugin)?void 0:E.session,S=E.customActionNameAttribute,T=E.onSessionRebuild,R=E.sessionGenerator,O=zn.SELF_GENETATE,C=(p=(c={onCreateOrRebuild:function(r){var o=(s=((e,t,n)=>{var o,i;if(r)return o=yr(),t(JSON.stringify(o)),o;if(n)return u(u({},"string"==typeof(o=n())?{sessionId:o}:{sessionId:null==o?void 0:o.aegis_session_id,linkSessionId:null==o?void 0:o.link_session_id,linkSpanId:null==o?void 0:o.link_span_id}),{sessionFrom:zn.SELF_INJECT});if(n=(null==(n=null==(n=window.location)?void 0:n.search)?void 0:n.substring(1)).split("&"),i="",n.some((function(e){return"aegis_session_id"===(e=e.split("="))[0]&&(i=decodeURIComponent(e[1]),!0)})),i)return n={sessionId:i,sessionFrom:zn.URL_QUERY},t(JSON.stringify(n)),n;var s=(n={sessionId:st.get(ur),linkSessionId:st.get(lr),linkSpanId:st.get(fr)}).sessionId,a=n.linkSessionId;if(n=n.linkSpanId,t("[cookie] ".concat(JSON.stringify({sessionId:s,linkSessionId:a,linkSpanId:n}))),s)return s={sessionId:s,sessionFrom:zn.COOKIES,linkSessionId:a,linkSpanId:n},t(JSON.stringify(s)),st.remove(ur),st.remove(lr),st.remove(fr),s;try{var c=localStorage.getItem(ur);if(null!==c){var l,f=JSON.parse(c),d=f.sessionId;if(e!==f.id)return l={sessionId:d,sessionFrom:zn.LOCAL_STORAGE},t(JSON.stringify(l)),l}}catch(e){}return(n=(null==(a=(()=>{for(var e=document.getElementsByTagName("meta"),t=0;t<e.length;t++){var n=e[t];if("traceparent"===n.getAttribute("name"))return n}return null})())?void 0:a.content)||"")?(s={sessionId:n.split("-")[1],sessionFrom:zn.SERVER_INJECT},t(JSON.stringify(s)),s):(c=yr(),t(JSON.stringify(c)),c)})(e.config.id,(function(t){e.logger.info("session from: ".concat(t))}),R)).sessionId,i=s.sessionFrom,s=l(s,["sessionId","sessionFrom"]);r&&null!=T&&T(o),O=i,n=s;try{localStorage.setItem(ur,JSON.stringify({id:e.config.id,sessionId:o}))}catch(r){}e.updateSnapshootInfo({session:{id:o}}),t("session",!0),r&&(e.updateSnapshootInfo({view:{id:q.generateSpanId(),loading_type:Jn.INITIAL_LOAD,view_name:document.title,view_url:window.location.href,referrer:""}}),t("view",!0))},onExpire:function(){try{localStorage.removeItem(ur)}catch(e){}x(),e.updateSnapshootInfo({session:void 0,view:void 0,action:void 0})}}).onCreateOrRebuild,h=c.onExpire,g=gr(),v=gr()+9e5,m=function(){return gr()-Number(g)<144e5&&gr()<Number(v)},k(),(d=["click","touchstart","keydown","scroll"]).forEach((function(e){return window.addEventListener.call(window,e,A,!0)})),function(){clearInterval(f),d.forEach((function(e){return window.removeEventListener.call(window,e,A)}))}),I=function(e){var t=e.onStart,n=e.onChange,r=null!=(e=window.external)&&e.assetsGC?hr:pr;function o(){var e,t,o,i;s.href!==window.location.href&&(e=r(window.location),(t=s).pathname===(o=e).pathname&&(i=o.hash,document.getElementById(null==i?void 0:i.substring(1))||vr(o.hash)===vr(t.hash))||(n(s,e),s=r(e)))}t();var i,s=r(window.location),a=(i=o,window.addEventListener("hashchange",i),(e=>{var t,n,r=Wn,o=Wn;try{null!=(t=Object.getOwnPropertyDescriptor(History.prototype,"pushState"))&&t.writable&&(r=dr(history,"pushState",{after:e}).stop),null!=(n=Object.getOwnPropertyDescriptor(History.prototype,"replaceState"))&&n.writable&&(o=dr(history,"replaceState",{after:e}).stop)}catch(e){}return{stop:function(){r(),o(),window.removeEventListener("popstate",e)}}})(o).stop);return function(){window.removeEventListener("hashchange",i),a()}}({onStart:function(){e.updateSnapshootInfo({view:{id:q.generateSpanId(),loading_type:Jn.INITIAL_LOAD,view_name:document.title,view_url:window.location.href,referrer:""}}),t("view",!0)},onChange:function(n,r){var o;null!=(o=e.snapshootInfo)&&o.action&&(t("action",!1),e.updateSnapshootInfo({action:void 0})),t("view",!1),null!=(o=null==e?void 0:e.updateSnapshootInfo)&&o.call(e,{view:{id:q.generateSpanId(),loading_type:Jn.ROUTE_CHANGE,view_name:document.title,view_url:r.href,referer:n.href}}),t("view",!0)}}),L=function(){};function k(e){void 0===e&&(e=!1),g=gr(),v=gr()+9e5,p(e),f=setInterval(P,1e3)}function A(){m()?v=gr()+9e5:k(!0)}function P(){m()||(h(),clearInterval(f))}function N(e){var t,n,r,c,u,l;function f(){r||(r=!0,t(),clearTimeout(u),clearTimeout(l),null==c)||c()}i()&&(e={action_type:e.type,action_name:mr(e.target,o),action_target_name:null==(e=null==(e=e.target)?void 0:e.nodeName)?void 0:e.toLowerCase()},s(e),t=a,r=!1,c=(e=>{function t(){e({isBusy:0<c})}var n,r,o,i,s,a,c=0,u=new br((function(e){var t;if(MutationObserver)return(t=new MutationObserver((function(){return e.notify()}))).observe(document,{attributes:!0,characterData:!0,childList:!0,subtree:!0}),function(){return t.disconnect()}})),l=new br((function(e){var t,n,r;return"function"==typeof(null==window?void 0:window.PerformanceObserver)?((t=new window.PerformanceObserver((function(){e.notify()}))).observe({entryTypes:["resource"]}),function(){t.disconnect()}):rt()?(n=performance.getEntriesByType("resource").length,r=setInterval((function(){var t=performance.getEntriesByType("resource");n<=t.length&&e.notify(),n=t.length}),100),function(){clearInterval(r),n=0}):Wn})),f=[u.subscribe(t),l.subscribe(t),(o=function(e){var n=e.state;e=e.requestIndex,"start"===n?(void 0===r&&(r=e),c+=1,t()):"end"!==n||void 0===r||e<r||(--c,t())},i=1,s=new br((function(e){var t=dr(XMLHttpRequest.prototype,"send",{before:function(){i+=1,this.requestIndex=i,e.notify({state:"start",requestIndex:i})},after:function(){var t=this,n=function(){t.removeEventListener("loadend",n),e.notify({state:"end",requestIndex:t.requestIndex})};this.addEventListener("loadend",n)}}).stop;return function(){return t()}})).subscribe(o),a=new br((function(e){var t=dr(window,"fetch",{before:function(){i+=1,e.notify({state:"start",requestIndex:i})},after:function(t){t.finally((function(){e.notify({state:"end",requestIndex:i})}))}}).stop;return function(){return t()}})).subscribe(o),{unsubscribe:function(){s.unsubscribe(),a.unsubscribe()}})],d=Wn;try{null!=(n=Object.getOwnPropertyDescriptor(window,"open"))&&n.writable&&(d=dr(window,"open",{before:t}).stop)}catch(e){}return{stop:function(){d(),f.forEach((function(e){return e.unsubscribe()}))}}})((function(e){clearTimeout(u),clearTimeout(n),e.isBusy||(n=setTimeout((function(){r||(r=!0,t(),clearTimeout(u),clearTimeout(l),null==c)||c()}),100))})).stop,u=setTimeout(f,100),l=setTimeout(f,1e4))}!1!==(b=void 0===b?["click"]:b)&&0!==b.length&&(r=(E={actionTypes:b,customActionNameAttribute:S}).actionTypes,o=E.customActionNameAttribute,i=(b={onBeforeStart:function(){var t;return!(!e.isWhiteList&&(Math.random()>(null!=(t=e.sampleMap[y.SESSION])?t:0)||null!=(t=e.snapshootInfo)&&t.action))},onStart:function(n){e.updateSnapshootInfo({action:u({id:q.generateSpanId(),timestamp:Date.now()},n)}),t("action",!0)},onEnd:function(){var n;null!=(n=e.snapshootInfo)&&n.action&&(t("action",!1),e.updateSnapshootInfo({action:void 0}))}}).onBeforeStart,s=b.onStart,a=b.onEnd,r.forEach((function(e){window.addEventListener.call(window,e,N,!0)})),L=function(){r.forEach((function(e){window.removeEventListener.call(window,e,N)}))});var x=function(){var n=e.snapshootInfo,r=n.session,o=n.view;n.action&&t("action",!1),o&&t("view",!1),r&&t("session",!1)};window.addEventListener.call(window,"beforeunload",(function(){e.sendNow=!0,x()}),!0),this.stopSessionPlugin=function(){var t;null!=(t=null==e?void 0:e.updateSnapshootInfo)&&t.call(e,{session:void 0,view:void 0,action:void 0}),C(),I(),L()}},publishSessionDataWithAegis:function(e,t){this.publish(u(u({},e),{msg:e.session_type,type:T.SESSION}),t)},destroy:function(){var e;null!=(e=this.stopSessionPlugin)&&e.call(this)}}),{containers:["body","html","#app","#root"],ignoreContainers:[],detectStartPosition:{x:0,y:0},emptyElementsPercent:70,sameElementsPercent:70,debounceDuration:1500,everySideSampleNumber:9,disableSameElementsCheck:!1,ignoreElesWhenDomChange:[],reDetectInterval:1500,samePointDepth:5}),Sr=["canvas","img","svg","iframe"];function Tr(e){this.onFirstSubscribe=e,this.observers=[]}function Rr(e){try{var t=e.config.plugin.blankScreen;return!0===t?Er:be(Er,t)}catch(e){return Er}}function Or(e,t){return function n(r){var o=r[0];if(o&&null!==o.shadowRoot){var i=(null==(i=null==o?void 0:o.shadowRoot)?void 0:i.elementsFromPoint(e,t))||[];if(i.length>r.length)return n(i)}return o}(document.elementsFromPoint(e,t))}function Cr(e){var t=null==(t=null==e?void 0:e.nodeName)?void 0:t.toLowerCase();return e.id?"".concat(t,"#").concat(e.id):e.className&&"string"==typeof e.className?"".concat(t,".").concat(e.className.split(" ").filter((function(e){return!!e})).join(".")):t}var Ir=wr={UNKNOWN:0,0:"UNKNOWN",ERROR:1,1:"ERROR",DOM_CHANGE:2,2:"DOM_CHANGE"};return Ir=new We({name:y.BLANK_SCREEN,onNewAegis:function(e){var t,n,r,o,i,s,a,c,l,p,h,g,v,m,y,w,b,E,R,O,C,I,k,A,N,x,_,M,D,q,F,H,j,B,U,W=this;null!=document&&document.elementFromPoint&&(v=Rr(e),r=v.everySideSampleNumber,o=v.sameElementsPercent,i=v.emptyElementsPercent,s=v.containers,a=v.ignoreContainers,c=v.debounceDuration,l=v.detectStartPosition,p=v.ignoreElesWhenDomChange,h=v.reDetectInterval,g=v.disableSameElementsCheck,v=4*r-3,m=Math.floor(v*i/100),y=Math.floor(v*o/100),w=wr.UNKNOWN,b=!1,R="",O=!(E={}),C=null,I=function(){return f(W,void 0,void 0,(function(){var o,i,p,v,w,O,I,A,P,N,x,_,M,D,q,F,H,j,B,U,W,G=this;return d(this,(function(K){switch(K.label){case 0:if(o=window.innerHeight,i=window.innerWidth,p=l.x,v=l.y,i<=p||o<=v)return[2];for(w=p+(i-p)/2,O=v+(o-v)/2,I=[],A=r+1,P=0,N=Date.now(),x=1;x<A;x++)F=v+(o-v)*x/A,_=Or(q=p+(i-p)*x/A,O),M=Or(w,F),D=Or(q,F),q=Or(q,o-F),F=(x===A/2?[_]:[_,M,D,q]).filter((function(e){return null!==e})),I.push.apply(I,F),P+=F.reduce((function(e,t){return e+Number((e=s,n=a,r=Cr(t),t=e.some((function(e){return r.includes(e)})),e=!n.some((function(e){return r.includes(e)})),t&&e));var n,r}),0);return H=m<=P,j=!1,g||(U=I.filter((function(e){return!Sr.includes(Cr(e))})),X=U[0]||null,V=0,U.reduce((function(e,t){var n=(e.get(t)||0)+1;return e.set(t,n),V<n&&(X=t,V=n),e}),new Map),B=(U={point:X,count:V}).point,j=y<=(U=U.count),!b&&j&&((W={})[(e=>{if(null===e)return"[Invalid Element]";for(var t=[];e&&e.nodeType===Node.ELEMENT_NODE;){var n=e.tagName.toLowerCase();if("html"===n)break;if(e.id&&/^[a-zA-Z_][a-zA-Z0-9_-]*$/.test(e.id)){n="#".concat(e.id),t.unshift(n);break}for(var r=e,o=1;r.previousElementSibling;)(r=r.previousElementSibling).tagName.toLowerCase()===e.tagName.toLowerCase()&&(o+=1);1<o&&(n+=":nth-of-type(".concat(o,")")),t.unshift(n),e=e.parentElement}return 0===t.length&&t.push("html"),t.join(" > ")})(B)]=U,C=W)),H||j?[3,1]:(b=!1,E={},C=null,[3,4]);case 1:return b?(R!==e.snapshootInfo.from&&E&&(this.publish({level:S.BLANK_SCREEN,type:T.PV}),R=e.snapshootInfo.from),B=be(E,g||null===C?{}:{maximumSamePointer:C},t?{linkLogId:null==t?void 0:t.aegisv2_goto,linkLogType:null==t?void 0:t.type,linkLogLevel:null==t?void 0:t.level,linkErrorMsg:null==t?void 0:t.errorMsg}:{}),this.publish(B,e),[4,e.setTempConfig({id:L},(function(){return e.reportTime("白屏检测总耗时",Date.now()-N)}))]):[3,3];case 2:return K.sent(),b=!1,E={},[3,4];case 3:U=Date.now()-e.timeOrigin-c,E=u({msg:"blank_screen",level:S.BLANK_SCREEN,type:T.NORMAL,triggerTime:U<0?0:U,whitePointCount:P},t?{linkLogId:null==t?void 0:t.aegisv2_goto,linkLogType:null==t?void 0:t.type,linkLogLevel:null==t?void 0:t.level,linkErrorMsg:null==t?void 0:t.errorMsg}:{}),b=!0,n=setTimeout((function(){return f(G,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return[4,k()];case 1:return e.sent(),[2]}}))}))}),h),K.label=4;case 4:return[2]}var X,V}))}))},k=function(){return f(W,void 0,void 0,(function(){var e=this;return d(this,(function(t){switch(t.label){case 0:return"requestIdleCallback"in window?(window.requestIdleCallback((function(t){return f(e,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return 0<t.timeRemaining()?[4,I()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))})),[3,3]):[3,1];case 1:return[4,I()];case 2:t.sent(),t.label=3;case 3:return[2]}}))}))},A=function(){var r;b||w===wr.ERROR&&!t||(w=t?wr.ERROR:wr.DOM_CHANGE,clearTimeout(n),r=Rr(e).debounceDuration,n=setTimeout((function(){return f(W,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return clearTimeout(n),[4,k()];case 1:return e.sent(),[2]}}))}))}),r))},e.event.on(P.errorOccurred,N=function(e){0<(e=e.filter((function(e){return e.level!==S.BLANK_SCREEN}))).length&&(t=e[e.length-1],A())}),x=null,window.MutationObserver&&(H=j=null,_=window.cancelAnimationFrame||function(e){clearTimeout(e)},M=window.requestAnimationFrame||function(e){return setTimeout(e,1e3/60)},D=function(){(x=new MutationObserver((function(e){var t=p.includes(Cr(e[0].target));1===e.length&&t||A()}))).observe(document.body,{childList:!0,subtree:!0})},q=function(){j&&(clearTimeout(j),j=null),H&&(_(H),H=null)},document.body?D():(H=M(F=function(){document.body?(q(),D()):H=M(F)}),j=setTimeout((function(){q()}),1e4))),B=function(){O&&(O=!0,b)&&(clearTimeout(n),I())},U=function(){"visible"===document.visibilityState&&(O=!1),"hidden"===document.visibilityState&&B()},window.addEventListener("pagehide",B),window.addEventListener("beforeunload",B),window.addEventListener("visibilitychange",U),this.destroyBlanckScreenDetect=function(){window.removeEventListener("pagehide",B),window.removeEventListener("beforeunload",B),window.removeEventListener("visibilitychange",U),e.event.remove(P.errorOccurred,N),null!=x&&x.disconnect()})},destroy:function(){this.destroyBlanckScreenDetect()}}),new We({name:y.WEBSOCKET}),We=new We({name:y.WEBSOCKET,init:function(e){var t=this;$e({key:"".concat(e.config.id,"-").concat(this.name),onErr:function(n){e.config.websocketHack||t.publishWsErrorLog(n,e)},sendErr:function(n){e.config.websocketHack||t.publishWsErrorLog(n,e)},sendConnectInfo:function(n){t.publish(u(u({},n),{level:S.INFO,type:T.WEBSOCKET}),e)}})},publishWsErrorLog:function(e,t){var n=e.connectUrl,r=e.msg;e=e.readyState,this.publish({msg:"WEBSOCKET_ERROR: \n              connect: ".concat(n,"\n              readyState: ").concat(e,"\n              msg: ").concat(r),level:S.WEBSOCKET_ERROR,type:T.WEBSOCKET},t)},destroy:function(){this.publishErrorLog=function(){},this.hackWebsocketConfig&&Ye(this.hackWebsocketConfig)}}),pn.use(cr),pn.use(at),pn.use(Ue),pn.use(mt),pn.use(ar),pn.use(lt),pn.use(bt),pn.use(rn),pn.use(ft),pn.use(on),pn.use(jn),pn.use(Ir),pn.use(We),pn}));